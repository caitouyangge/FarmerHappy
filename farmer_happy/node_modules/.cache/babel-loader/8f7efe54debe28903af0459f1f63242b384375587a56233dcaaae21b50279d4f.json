{"ast":null,"code":"import { ref, computed, onMounted, watch } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { orderService } from '../api/order';\nimport logger from '../utils/logger';\nexport default {\n  name: 'OrderDetail',\n  setup() {\n    const route = useRoute();\n    const router = useRouter();\n    const orderId = computed(() => {\n      const id = route.params.id;\n      // 确保返回字符串类型，避免 undefined\n      return id ? String(id) : null;\n    });\n    const orderDetail = ref(null);\n    const loading = ref(false);\n    const error = ref('');\n    const showImagePreview = ref(false);\n    const previewImage = ref('');\n    const showRefundDialog = ref(false);\n    const refundForm = ref({\n      refundType: '',\n      refundReason: ''\n    });\n\n    // 获取用户信息\n    const userInfo = ref({});\n    const userPhone = computed(() => {\n      return userInfo.value.phone || '';\n    });\n    const isBuyer = computed(() => {\n      return userInfo.value.userType === 'buyer';\n    });\n    const isFarmer = computed(() => {\n      return userInfo.value.userType === 'farmer';\n    });\n\n    // 获取当前有效的订单ID\n    const getCurrentOrderId = () => {\n      return route.params.id || orderId.value || orderDetail.value?.order_id;\n    };\n\n    // 加载用户信息\n    const loadUserInfo = () => {\n      const storedUser = localStorage.getItem('user');\n      if (storedUser) {\n        try {\n          userInfo.value = JSON.parse(storedUser);\n        } catch (err) {\n          logger.error('ORDER_DETAIL', '解析用户信息失败', {}, err);\n        }\n      }\n    };\n\n    // 加载订单详情\n    const loadOrderDetail = async () => {\n      if (!userPhone.value) {\n        error.value = '请先登录';\n        return;\n      }\n\n      // 获取当前路由参数，确保获取到最新的值\n      const currentOrderId = route.params.id || orderId.value;\n      if (!currentOrderId) {\n        error.value = '订单ID不存在，请从订单列表进入';\n        logger.error('ORDER_DETAIL', '订单ID不存在', {\n          routeParams: route.params,\n          orderIdValue: orderId.value\n        });\n        return;\n      }\n      loading.value = true;\n      error.value = '';\n      try {\n        logger.info('ORDER_DETAIL', '开始加载订单详情', {\n          orderId: currentOrderId,\n          userType: userInfo.value.userType,\n          phone: userPhone.value,\n          routeParams: route.params\n        });\n        let data;\n        if (isBuyer.value) {\n          // 买家查询订单详情\n          data = await orderService.getOrderDetail(currentOrderId, {\n            buyer_phone: userPhone.value\n          });\n        } else if (isFarmer.value) {\n          // 农户查询订单详情\n          data = await orderService.getFarmerOrderDetail(currentOrderId, {\n            farmer_phone: userPhone.value\n          });\n        } else {\n          error.value = '当前用户类型不支持查看订单详情';\n          return;\n        }\n        orderDetail.value = data;\n        logger.info('ORDER_DETAIL', '订单详情加载成功', {\n          orderId: currentOrderId,\n          status: data.status\n        });\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '加载订单详情失败', {\n          orderId: currentOrderId,\n          routeParams: route.params,\n          errorMessage: err.message || err\n        }, err);\n        error.value = err.message || '加载订单详情失败，请稍后重试';\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 格式化日期时间\n    const formatDateTime = dateString => {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      const hours = String(date.getHours()).padStart(2, '0');\n      const minutes = String(date.getMinutes()).padStart(2, '0');\n      const seconds = String(date.getSeconds()).padStart(2, '0');\n      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n    };\n\n    // 格式化价格\n    const formatPrice = price => {\n      if (!price) return '0.00';\n      return parseFloat(price).toFixed(2);\n    };\n\n    // 获取状态文本\n    const getStatusText = status => {\n      const statusMap = {\n        shipped: '已发货',\n        completed: '已完成',\n        cancelled: '已取消',\n        refunded: '已退款'\n      };\n      return statusMap[status] || status;\n    };\n\n    // 返回\n    const handleBack = () => {\n      router.push('/orders');\n    };\n\n    // 点击图片预览\n    const handleImageClick = image => {\n      previewImage.value = image;\n      showImagePreview.value = true;\n    };\n\n    // 确认收货\n    const handleConfirmReceipt = async () => {\n      if (!confirm('确认收到商品吗？')) {\n        return;\n      }\n      try {\n        const currentOrderId = getCurrentOrderId();\n        if (!currentOrderId) {\n          alert('订单ID不存在');\n          return;\n        }\n        logger.userAction('ORDER_CONFIRM_RECEIPT', {\n          orderId: currentOrderId\n        });\n        await orderService.confirmReceipt(currentOrderId, {\n          buyer_phone: userPhone.value\n        });\n        alert('确认收货成功！');\n        loadOrderDetail();\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '确认收货失败', {\n          orderId: getCurrentOrderId(),\n          errorMessage: err.message || err\n        }, err);\n        alert(err.message || '确认收货失败，请稍后重试');\n      }\n    };\n\n    // 申请退款\n    const handleApplyRefund = () => {\n      refundForm.value = {\n        refundType: '',\n        refundReason: ''\n      };\n      showRefundDialog.value = true;\n    };\n\n    // 提交退款申请\n    const handleSubmitRefund = async () => {\n      if (!refundForm.value.refundType) {\n        alert('请选择退款类型');\n        return;\n      }\n      if (!refundForm.value.refundReason.trim()) {\n        alert('请输入退款原因');\n        return;\n      }\n      try {\n        const currentOrderId = getCurrentOrderId();\n        if (!currentOrderId) {\n          alert('订单ID不存在');\n          return;\n        }\n        logger.userAction('ORDER_APPLY_REFUND', {\n          orderId: currentOrderId,\n          refundType: refundForm.value.refundType\n        });\n        await orderService.applyRefund(currentOrderId, {\n          buyer_phone: userPhone.value,\n          refund_type: refundForm.value.refundType,\n          refund_reason: refundForm.value.refundReason.trim()\n        });\n        alert('退款申请提交成功！');\n        showRefundDialog.value = false;\n        loadOrderDetail();\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '申请退款失败', {\n          orderId: getCurrentOrderId(),\n          errorMessage: err.message || err,\n          errors: err.errors || []\n        }, err);\n        if (err.errors && Array.isArray(err.errors) && err.errors.length > 0) {\n          const errorMessages = err.errors.map(e => e.message).join('\\n');\n          alert(errorMessages || '申请退款失败，请稍后重试');\n        } else {\n          alert(err.message || '申请退款失败，请稍后重试');\n        }\n      }\n    };\n\n    // 取消订单\n    const handleCancelOrder = async () => {\n      const reason = prompt('请输入取消原因（选填）：');\n      if (reason === null) {\n        return;\n      }\n      try {\n        const currentOrderId = getCurrentOrderId();\n        if (!currentOrderId) {\n          alert('订单ID不存在');\n          return;\n        }\n        logger.userAction('ORDER_CANCEL', {\n          orderId: currentOrderId\n        });\n        await orderService.cancelOrder(currentOrderId, {\n          buyer_phone: userPhone.value,\n          cancel_reason: reason || undefined\n        });\n        alert('订单取消成功！');\n        loadOrderDetail();\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '取消订单失败', {\n          orderId: getCurrentOrderId(),\n          errorMessage: err.message || err\n        }, err);\n        alert(err.message || '取消订单失败，请稍后重试');\n      }\n    };\n\n    // 监听路由参数变化\n    watch(() => route.params.id, newId => {\n      if (newId) {\n        loadOrderDetail();\n      }\n    }, {\n      immediate: false\n    });\n\n    // 初始化\n    onMounted(() => {\n      loadUserInfo();\n      // 确保路由参数已加载\n      const currentOrderId = getCurrentOrderId();\n      if (currentOrderId) {\n        loadOrderDetail();\n      } else {\n        // 如果路由参数未加载，等待一下再试\n        setTimeout(() => {\n          const retryOrderId = getCurrentOrderId();\n          if (retryOrderId) {\n            loadOrderDetail();\n          } else {\n            error.value = '订单ID不存在，请从订单列表进入';\n          }\n        }, 100);\n      }\n    });\n    return {\n      orderId,\n      orderDetail,\n      loading,\n      error,\n      isBuyer,\n      isFarmer,\n      showImagePreview,\n      previewImage,\n      showRefundDialog,\n      refundForm,\n      formatDateTime,\n      formatPrice,\n      getStatusText,\n      handleBack,\n      handleImageClick,\n      handleConfirmReceipt,\n      handleApplyRefund,\n      handleSubmitRefund,\n      handleCancelOrder,\n      loadOrderDetail\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","useRoute","useRouter","orderService","logger","name","setup","route","router","orderId","id","params","String","orderDetail","loading","error","showImagePreview","previewImage","showRefundDialog","refundForm","refundType","refundReason","userInfo","userPhone","value","phone","isBuyer","userType","isFarmer","getCurrentOrderId","order_id","loadUserInfo","storedUser","localStorage","getItem","JSON","parse","err","loadOrderDetail","currentOrderId","routeParams","orderIdValue","info","data","getOrderDetail","buyer_phone","getFarmerOrderDetail","farmer_phone","status","errorMessage","message","formatDateTime","dateString","date","Date","year","getFullYear","month","getMonth","padStart","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","formatPrice","price","parseFloat","toFixed","getStatusText","statusMap","shipped","completed","cancelled","refunded","handleBack","push","handleImageClick","image","handleConfirmReceipt","confirm","alert","userAction","confirmReceipt","handleApplyRefund","handleSubmitRefund","trim","applyRefund","refund_type","refund_reason","errors","Array","isArray","length","errorMessages","map","e","join","handleCancelOrder","reason","prompt","cancelOrder","cancel_reason","undefined","newId","immediate","setTimeout","retryOrderId"],"sources":["D:\\STUDY\\FarmerHappy\\farmer_happy\\src\\orders\\OrderDetail.vue"],"sourcesContent":["<template>\n  <div class=\"order-detail-container\">\n    <!-- 顶部导航栏 -->\n    <header class=\"header\">\n      <div class=\"header-left\">\n        <button class=\"btn-back\" @click=\"handleBack\">\n          <span class=\"back-icon\">←</span>\n          返回\n        </button>\n        <h1 class=\"page-title\">订单详情</h1>\n      </div>\n    </header>\n\n    <!-- 主内容区域 -->\n    <main class=\"main-content\">\n      <div class=\"content-wrapper\">\n        <!-- 加载状态 -->\n        <div v-if=\"loading\" class=\"loading-container\">\n          <div class=\"loading-spinner\"></div>\n          <p>加载中...</p>\n        </div>\n\n        <!-- 错误提示 -->\n        <div v-else-if=\"error\" class=\"error-container\">\n          <div class=\"error-message\">\n            <span class=\"error-icon\">⚠️</span>\n            <span class=\"error-text\">{{ error }}</span>\n          </div>\n          <button class=\"btn-retry\" @click=\"loadOrderDetail\">重试</button>\n        </div>\n\n        <!-- 订单详情 -->\n        <div v-else-if=\"orderDetail\" class=\"order-detail\">\n          <!-- 订单状态卡片 -->\n          <div class=\"status-card\">\n            <div class=\"status-header\">\n              <span class=\"status-label\">订单状态</span>\n              <span :class=\"['status-badge', `status-${orderDetail.status}`]\">\n                {{ getStatusText(orderDetail.status) }}\n              </span>\n            </div>\n            <div class=\"status-info\">\n              <p class=\"order-id-text\">订单号：{{ orderDetail.order_id }}</p>\n              <p class=\"create-time\">创建时间：{{ formatDateTime(orderDetail.created_at) }}</p>\n              <p v-if=\"orderDetail.shipped_at\" class=\"time-info\">\n                发货时间：{{ formatDateTime(orderDetail.shipped_at) }}\n              </p>\n              <p v-if=\"orderDetail.completed_at\" class=\"time-info\">\n                完成时间：{{ formatDateTime(orderDetail.completed_at) }}\n              </p>\n              <p v-if=\"orderDetail.cancelled_at\" class=\"time-info\">\n                取消时间：{{ formatDateTime(orderDetail.cancelled_at) }}\n              </p>\n              <p v-if=\"orderDetail.refunded_at\" class=\"time-info\">\n                退款时间：{{ formatDateTime(orderDetail.refunded_at) }}\n              </p>\n            </div>\n          </div>\n\n          <!-- 商品信息 -->\n          <div class=\"section-card\">\n            <h2 class=\"section-title\">商品信息</h2>\n            <div class=\"product-info\">\n              <div v-if=\"orderDetail.images && orderDetail.images.length > 0\" class=\"product-images\">\n                <img\n                  v-for=\"(image, index) in orderDetail.images\"\n                  :key=\"index\"\n                  :src=\"image\"\n                  :alt=\"orderDetail.title\"\n                  class=\"product-image\"\n                  @click=\"handleImageClick(image)\"\n                />\n              </div>\n              <div class=\"product-details\">\n                <h3 class=\"product-title\">{{ orderDetail.title }}</h3>\n                <div v-if=\"orderDetail.specification\" class=\"product-spec\">\n                  规格：{{ orderDetail.specification }}\n                </div>\n                <div class=\"product-price-info\">\n                  <div class=\"price-row\">\n                    <span class=\"price-label\">单价：</span>\n                    <span class=\"price-value\">¥{{ formatPrice(orderDetail.price) }}</span>\n                  </div>\n                  <div class=\"price-row\">\n                    <span class=\"price-label\">数量：</span>\n                    <span class=\"price-value\">{{ orderDetail.quantity }} 斤</span>\n                  </div>\n                  <div class=\"price-row total\">\n                    <span class=\"price-label\">订单总额：</span>\n                    <span class=\"price-value total-price\">¥{{ formatPrice(orderDetail.total_amount) }}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- 收货信息 -->\n          <div class=\"section-card\">\n            <h2 class=\"section-title\">收货信息</h2>\n            <div class=\"delivery-info\">\n              <div class=\"info-row\">\n                <span class=\"info-label\">收货人：</span>\n                <span class=\"info-value\">{{ orderDetail.buyer_name }}</span>\n              </div>\n              <div class=\"info-row\">\n                <span class=\"info-label\">手机号：</span>\n                <span class=\"info-value\">{{ orderDetail.buyer_phone }}</span>\n              </div>\n              <div class=\"info-row\">\n                <span class=\"info-label\">收货地址：</span>\n                <span class=\"info-value\">{{ orderDetail.buyer_address }}</span>\n              </div>\n            </div>\n          </div>\n\n          <!-- 订单备注 -->\n          <div v-if=\"orderDetail.remark\" class=\"section-card\">\n            <h2 class=\"section-title\">订单备注</h2>\n            <p class=\"remark-text\">{{ orderDetail.remark }}</p>\n          </div>\n\n          <!-- 操作按钮 -->\n          <div v-if=\"isBuyer\" class=\"action-section\">\n            <button\n              v-if=\"orderDetail.status === 'shipped'\"\n              class=\"btn-action btn-primary\"\n              @click=\"handleConfirmReceipt\"\n            >\n              确认收货\n            </button>\n            <button\n              v-if=\"orderDetail.status === 'shipped'\"\n              class=\"btn-action btn-secondary\"\n              @click=\"handleApplyRefund\"\n            >\n              申请退款\n            </button>\n            <button\n              v-if=\"orderDetail.status === 'shipped'\"\n              class=\"btn-action btn-cancel\"\n              @click=\"handleCancelOrder\"\n            >\n              取消订单\n            </button>\n            <button\n              class=\"btn-action btn-default\"\n              @click=\"handleBack\"\n            >\n              返回订单列表\n            </button>\n          </div>\n          <div v-else class=\"action-section\">\n            <button\n              class=\"btn-action btn-default\"\n              @click=\"handleBack\"\n            >\n              返回订单列表\n            </button>\n          </div>\n        </div>\n      </div>\n    </main>\n\n    <!-- 图片预览模态框 -->\n    <div v-if=\"showImagePreview\" class=\"image-modal\" @click=\"showImagePreview = false\">\n      <img :src=\"previewImage\" alt=\"预览\" class=\"preview-image\" @click.stop />\n      <button class=\"close-preview\" @click=\"showImagePreview = false\">×</button>\n    </div>\n\n    <!-- 退款对话框 -->\n    <div v-if=\"showRefundDialog\" class=\"dialog-overlay\" @click=\"showRefundDialog = false\">\n      <div class=\"dialog-content\" @click.stop>\n        <h3 class=\"dialog-title\">申请退款</h3>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label class=\"form-label\">退款类型</label>\n            <select v-model=\"refundForm.refundType\" class=\"form-input\">\n              <option value=\"\">请选择退款类型</option>\n              <option value=\"refund\">仅退款</option>\n              <option value=\"refund_return\">退货退款</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-label\">退款原因 <span class=\"required\">*</span></label>\n            <textarea\n              v-model=\"refundForm.refundReason\"\n              class=\"form-textarea\"\n              placeholder=\"请输入退款原因\"\n              rows=\"4\"\n            ></textarea>\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"btn-dialog btn-cancel\" @click=\"showRefundDialog = false\">取消</button>\n          <button class=\"btn-dialog btn-confirm\" @click=\"handleSubmitRefund\">提交</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted, watch } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { orderService } from '../api/order';\nimport logger from '../utils/logger';\n\nexport default {\n  name: 'OrderDetail',\n  setup() {\n    const route = useRoute();\n    const router = useRouter();\n    const orderId = computed(() => {\n      const id = route.params.id;\n      // 确保返回字符串类型，避免 undefined\n      return id ? String(id) : null;\n    });\n    const orderDetail = ref(null);\n    const loading = ref(false);\n    const error = ref('');\n    const showImagePreview = ref(false);\n    const previewImage = ref('');\n    const showRefundDialog = ref(false);\n    const refundForm = ref({\n      refundType: '',\n      refundReason: ''\n    });\n\n    // 获取用户信息\n    const userInfo = ref({});\n    const userPhone = computed(() => {\n      return userInfo.value.phone || '';\n    });\n    const isBuyer = computed(() => {\n      return userInfo.value.userType === 'buyer';\n    });\n    const isFarmer = computed(() => {\n      return userInfo.value.userType === 'farmer';\n    });\n\n    // 获取当前有效的订单ID\n    const getCurrentOrderId = () => {\n      return route.params.id || orderId.value || orderDetail.value?.order_id;\n    };\n\n    // 加载用户信息\n    const loadUserInfo = () => {\n      const storedUser = localStorage.getItem('user');\n      if (storedUser) {\n        try {\n          userInfo.value = JSON.parse(storedUser);\n        } catch (err) {\n          logger.error('ORDER_DETAIL', '解析用户信息失败', {}, err);\n        }\n      }\n    };\n\n    // 加载订单详情\n    const loadOrderDetail = async () => {\n      if (!userPhone.value) {\n        error.value = '请先登录';\n        return;\n      }\n\n      // 获取当前路由参数，确保获取到最新的值\n      const currentOrderId = route.params.id || orderId.value;\n      if (!currentOrderId) {\n        error.value = '订单ID不存在，请从订单列表进入';\n        logger.error('ORDER_DETAIL', '订单ID不存在', {\n          routeParams: route.params,\n          orderIdValue: orderId.value\n        });\n        return;\n      }\n\n      loading.value = true;\n      error.value = '';\n\n      try {\n        logger.info('ORDER_DETAIL', '开始加载订单详情', {\n          orderId: currentOrderId,\n          userType: userInfo.value.userType,\n          phone: userPhone.value,\n          routeParams: route.params\n        });\n\n        let data;\n\n        if (isBuyer.value) {\n          // 买家查询订单详情\n          data = await orderService.getOrderDetail(currentOrderId, {\n            buyer_phone: userPhone.value\n          });\n        } else if (isFarmer.value) {\n          // 农户查询订单详情\n          data = await orderService.getFarmerOrderDetail(currentOrderId, {\n            farmer_phone: userPhone.value\n          });\n        } else {\n          error.value = '当前用户类型不支持查看订单详情';\n          return;\n        }\n\n        orderDetail.value = data;\n\n        logger.info('ORDER_DETAIL', '订单详情加载成功', {\n          orderId: currentOrderId,\n          status: data.status\n        });\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '加载订单详情失败', {\n          orderId: currentOrderId,\n          routeParams: route.params,\n          errorMessage: err.message || err\n        }, err);\n        error.value = err.message || '加载订单详情失败，请稍后重试';\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 格式化日期时间\n    const formatDateTime = (dateString) => {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      const hours = String(date.getHours()).padStart(2, '0');\n      const minutes = String(date.getMinutes()).padStart(2, '0');\n      const seconds = String(date.getSeconds()).padStart(2, '0');\n      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n    };\n\n    // 格式化价格\n    const formatPrice = (price) => {\n      if (!price) return '0.00';\n      return parseFloat(price).toFixed(2);\n    };\n\n    // 获取状态文本\n    const getStatusText = (status) => {\n      const statusMap = {\n        shipped: '已发货',\n        completed: '已完成',\n        cancelled: '已取消',\n        refunded: '已退款'\n      };\n      return statusMap[status] || status;\n    };\n\n    // 返回\n    const handleBack = () => {\n      router.push('/orders');\n    };\n\n    // 点击图片预览\n    const handleImageClick = (image) => {\n      previewImage.value = image;\n      showImagePreview.value = true;\n    };\n\n    // 确认收货\n    const handleConfirmReceipt = async () => {\n      if (!confirm('确认收到商品吗？')) {\n        return;\n      }\n\n      try {\n        const currentOrderId = getCurrentOrderId();\n        if (!currentOrderId) {\n          alert('订单ID不存在');\n          return;\n        }\n        logger.userAction('ORDER_CONFIRM_RECEIPT', { orderId: currentOrderId });\n        await orderService.confirmReceipt(currentOrderId, {\n          buyer_phone: userPhone.value\n        });\n        alert('确认收货成功！');\n        loadOrderDetail();\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '确认收货失败', {\n          orderId: getCurrentOrderId(),\n          errorMessage: err.message || err\n        }, err);\n        alert(err.message || '确认收货失败，请稍后重试');\n      }\n    };\n\n    // 申请退款\n    const handleApplyRefund = () => {\n      refundForm.value = {\n        refundType: '',\n        refundReason: ''\n      };\n      showRefundDialog.value = true;\n    };\n\n    // 提交退款申请\n    const handleSubmitRefund = async () => {\n      if (!refundForm.value.refundType) {\n        alert('请选择退款类型');\n        return;\n      }\n\n      if (!refundForm.value.refundReason.trim()) {\n        alert('请输入退款原因');\n        return;\n      }\n\n      try {\n        const currentOrderId = getCurrentOrderId();\n        if (!currentOrderId) {\n          alert('订单ID不存在');\n          return;\n        }\n        logger.userAction('ORDER_APPLY_REFUND', {\n          orderId: currentOrderId,\n          refundType: refundForm.value.refundType\n        });\n\n        await orderService.applyRefund(currentOrderId, {\n          buyer_phone: userPhone.value,\n          refund_type: refundForm.value.refundType,\n          refund_reason: refundForm.value.refundReason.trim()\n        });\n\n        alert('退款申请提交成功！');\n        showRefundDialog.value = false;\n        loadOrderDetail();\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '申请退款失败', {\n          orderId: getCurrentOrderId(),\n          errorMessage: err.message || err,\n          errors: err.errors || []\n        }, err);\n\n        if (err.errors && Array.isArray(err.errors) && err.errors.length > 0) {\n          const errorMessages = err.errors.map(e => e.message).join('\\n');\n          alert(errorMessages || '申请退款失败，请稍后重试');\n        } else {\n          alert(err.message || '申请退款失败，请稍后重试');\n        }\n      }\n    };\n\n    // 取消订单\n    const handleCancelOrder = async () => {\n      const reason = prompt('请输入取消原因（选填）：');\n      if (reason === null) {\n        return;\n      }\n\n      try {\n        const currentOrderId = getCurrentOrderId();\n        if (!currentOrderId) {\n          alert('订单ID不存在');\n          return;\n        }\n        logger.userAction('ORDER_CANCEL', { orderId: currentOrderId });\n        await orderService.cancelOrder(currentOrderId, {\n          buyer_phone: userPhone.value,\n          cancel_reason: reason || undefined\n        });\n        alert('订单取消成功！');\n        loadOrderDetail();\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '取消订单失败', {\n          orderId: getCurrentOrderId(),\n          errorMessage: err.message || err\n        }, err);\n        alert(err.message || '取消订单失败，请稍后重试');\n      }\n    };\n\n    // 监听路由参数变化\n    watch(() => route.params.id, (newId) => {\n      if (newId) {\n        loadOrderDetail();\n      }\n    }, { immediate: false });\n\n    // 初始化\n    onMounted(() => {\n      loadUserInfo();\n      // 确保路由参数已加载\n      const currentOrderId = getCurrentOrderId();\n      if (currentOrderId) {\n        loadOrderDetail();\n      } else {\n        // 如果路由参数未加载，等待一下再试\n        setTimeout(() => {\n          const retryOrderId = getCurrentOrderId();\n          if (retryOrderId) {\n            loadOrderDetail();\n          } else {\n            error.value = '订单ID不存在，请从订单列表进入';\n          }\n        }, 100);\n      }\n    });\n\n    return {\n      orderId,\n      orderDetail,\n      loading,\n      error,\n      isBuyer,\n      isFarmer,\n      showImagePreview,\n      previewImage,\n      showRefundDialog,\n      refundForm,\n      formatDateTime,\n      formatPrice,\n      getStatusText,\n      handleBack,\n      handleImageClick,\n      handleConfirmReceipt,\n      handleApplyRefund,\n      handleSubmitRefund,\n      handleCancelOrder,\n      loadOrderDetail\n    };\n  }\n};\n</script>\n\n<style scoped>\n@import '../assets/styles/theme.css';\n\n.order-detail-container {\n  min-height: 100vh;\n  background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);\n}\n\n/* 顶部导航栏 */\n.header {\n  background: var(--white);\n  padding: 1rem 2rem;\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.1);\n  position: sticky;\n  top: 0;\n  z-index: 100;\n}\n\n.header-left {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.btn-back {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  background: transparent;\n  border: 1px solid var(--gray-300);\n  border-radius: 8px;\n  color: var(--gray-600);\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.btn-back:hover {\n  background: var(--gray-100);\n  border-color: var(--primary);\n  color: var(--primary);\n}\n\n.back-icon {\n  font-size: 1.125rem;\n}\n\n.page-title {\n  font-size: 1.5rem;\n  font-weight: 600;\n  color: var(--primary);\n  margin: 0;\n}\n\n/* 主内容区域 */\n.main-content {\n  padding: 2rem;\n}\n\n.content-wrapper {\n  max-width: 900px;\n  margin: 0 auto;\n}\n\n/* 加载状态 */\n.loading-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 4rem 2rem;\n  background: var(--white);\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\n}\n\n.loading-spinner {\n  width: 40px;\n  height: 40px;\n  border: 4px solid var(--gray-200);\n  border-top: 4px solid var(--primary);\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin-bottom: 1rem;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n/* 错误提示 */\n.error-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 4rem 2rem;\n  background: var(--white);\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\n  gap: 1rem;\n}\n\n.error-message {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  color: var(--error);\n  font-size: 1rem;\n}\n\n.error-icon {\n  font-size: 1.25rem;\n}\n\n.btn-retry {\n  padding: 0.75rem 1.5rem;\n  background: var(--primary);\n  color: var(--white);\n  border: none;\n  border-radius: 8px;\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.btn-retry:hover {\n  background: var(--primary-dark);\n}\n\n/* 订单详情 */\n.order-detail {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n\n/* 状态卡片 */\n.status-card {\n  background: var(--white);\n  border-radius: 12px;\n  padding: 1.5rem;\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\n}\n\n.status-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid var(--gray-200);\n}\n\n.status-label {\n  font-size: 1rem;\n  font-weight: 600;\n  color: #1a202c;\n}\n\n.status-badge {\n  padding: 0.5rem 1rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 500;\n}\n\n.status-shipped {\n  background: #e0f2fe;\n  color: #0369a1;\n}\n\n.status-completed {\n  background: #dcfce7;\n  color: #166534;\n}\n\n.status-cancelled {\n  background: #fee2e2;\n  color: #991b1b;\n}\n\n.status-refunded {\n  background: #fef3c7;\n  color: #92400e;\n}\n\n.status-info {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.order-id-text {\n  font-size: 0.875rem;\n  color: #1a202c;\n  margin: 0;\n}\n\n.create-time,\n.time-info {\n  font-size: 0.875rem;\n  color: var(--gray-500);\n  margin: 0;\n}\n\n/* 通用卡片 */\n.section-card {\n  background: var(--white);\n  border-radius: 12px;\n  padding: 1.5rem;\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\n}\n\n.section-title {\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #1a202c;\n  margin: 0 0 1rem 0;\n  padding-bottom: 0.75rem;\n  border-bottom: 2px solid var(--primary-light);\n}\n\n/* 商品信息 */\n.product-info {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n\n.product-images {\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n}\n\n.product-image {\n  width: 120px;\n  height: 120px;\n  object-fit: cover;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: transform 0.2s;\n  border: 1px solid var(--gray-200);\n}\n\n.product-image:hover {\n  transform: scale(1.05);\n}\n\n.product-details {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n.product-title {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: #1a202c;\n  margin: 0;\n}\n\n.product-spec {\n  font-size: 0.875rem;\n  color: var(--gray-500);\n}\n\n.product-price-info {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  padding: 1rem;\n  background: var(--gray-100);\n  border-radius: 8px;\n}\n\n.price-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.price-label {\n  font-size: 0.875rem;\n  color: var(--gray-600);\n}\n\n.price-value {\n  font-size: 0.875rem;\n  color: #1a202c;\n  font-weight: 500;\n}\n\n.price-row.total {\n  padding-top: 0.75rem;\n  border-top: 2px solid rgba(107, 70, 193, 0.2);\n  margin-top: 0.25rem;\n}\n\n.price-row.total .price-label {\n  font-size: 1rem;\n  font-weight: 600;\n}\n\n.total-price {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--primary);\n}\n\n/* 收货信息 */\n.delivery-info {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n.info-row {\n  display: flex;\n  align-items: flex-start;\n  gap: 1rem;\n}\n\n.info-label {\n  font-size: 0.875rem;\n  color: var(--gray-600);\n  min-width: 80px;\n  flex-shrink: 0;\n}\n\n.info-value {\n  font-size: 0.875rem;\n  color: #1a202c;\n  flex: 1;\n}\n\n/* 订单备注 */\n.remark-text {\n  font-size: 0.875rem;\n  color: #1a202c;\n  line-height: 1.6;\n  margin: 0;\n  padding: 1rem;\n  background: var(--gray-100);\n  border-radius: 8px;\n}\n\n/* 操作按钮 */\n.action-section {\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n  padding: 1.5rem;\n  background: var(--white);\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\n}\n\n.btn-action {\n  flex: 1;\n  min-width: 120px;\n  padding: 0.875rem 1.5rem;\n  border: none;\n  border-radius: 8px;\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.btn-action.btn-primary {\n  background: var(--primary);\n  color: var(--white);\n}\n\n.btn-action.btn-primary:hover {\n  background: var(--primary-dark);\n}\n\n.btn-action.btn-secondary {\n  background: var(--white);\n  color: var(--primary);\n  border: 1px solid var(--primary);\n}\n\n.btn-action.btn-secondary:hover {\n  background: var(--primary-light);\n  color: var(--white);\n}\n\n.btn-action.btn-cancel {\n  background: var(--white);\n  color: var(--error);\n  border: 1px solid var(--error);\n}\n\n.btn-action.btn-cancel:hover {\n  background: var(--error);\n  color: var(--white);\n}\n\n.btn-action.btn-default {\n  background: var(--gray-200);\n  color: var(--gray-600);\n}\n\n.btn-action.btn-default:hover {\n  background: var(--gray-300);\n}\n\n/* 图片预览模态框 */\n.image-modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.9);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000;\n  padding: 2rem;\n}\n\n.preview-image {\n  max-width: 90%;\n  max-height: 90%;\n  object-fit: contain;\n  border-radius: 8px;\n}\n\n.close-preview {\n  position: absolute;\n  top: 2rem;\n  right: 2rem;\n  width: 40px;\n  height: 40px;\n  border: none;\n  background: rgba(255, 255, 255, 0.2);\n  color: var(--white);\n  border-radius: 50%;\n  font-size: 1.5rem;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.close-preview:hover {\n  background: rgba(255, 255, 255, 0.3);\n}\n\n/* 退款对话框 */\n.dialog-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000;\n  padding: 1rem;\n}\n\n.dialog-content {\n  background: var(--white);\n  border-radius: 12px;\n  padding: 2rem;\n  width: 100%;\n  max-width: 500px;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\n}\n\n.dialog-title {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: #1a202c;\n  margin: 0 0 1.5rem 0;\n}\n\n.dialog-body {\n  margin-bottom: 1.5rem;\n}\n\n.form-group {\n  margin-bottom: 1rem;\n}\n\n.form-label {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #1a202c;\n}\n\n.required {\n  color: var(--error);\n}\n\n.form-input,\n.form-textarea {\n  width: 100%;\n  padding: 0.75rem;\n  border: 1px solid var(--gray-300);\n  border-radius: 8px;\n  font-size: 0.875rem;\n  font-family: inherit;\n  transition: border-color 0.2s;\n}\n\n.form-input:focus,\n.form-textarea:focus {\n  outline: none;\n  border-color: var(--primary);\n}\n\n.form-textarea {\n  resize: vertical;\n  min-height: 100px;\n}\n\n.dialog-footer {\n  display: flex;\n  gap: 1rem;\n  justify-content: flex-end;\n}\n\n.btn-dialog {\n  padding: 0.75rem 1.5rem;\n  border: none;\n  border-radius: 8px;\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.btn-dialog.btn-cancel {\n  background: var(--gray-200);\n  color: var(--gray-600);\n}\n\n.btn-dialog.btn-cancel:hover {\n  background: var(--gray-300);\n}\n\n.btn-dialog.btn-confirm {\n  background: var(--primary);\n  color: var(--white);\n}\n\n.btn-dialog.btn-confirm:hover {\n  background: var(--primary-dark);\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .header {\n    padding: 1rem;\n  }\n\n  .main-content {\n    padding: 1rem;\n  }\n\n  .status-card,\n  .section-card {\n    padding: 1rem;\n  }\n\n  .product-images {\n    justify-content: center;\n  }\n\n  .product-image {\n    width: 100px;\n    height: 100px;\n  }\n\n  .action-section {\n    flex-direction: column;\n  }\n\n  .btn-action {\n    width: 100%;\n  }\n\n  .dialog-content {\n    padding: 1.5rem;\n  }\n\n  .dialog-footer {\n    flex-direction: column;\n  }\n\n  .btn-dialog {\n    width: 100%;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}