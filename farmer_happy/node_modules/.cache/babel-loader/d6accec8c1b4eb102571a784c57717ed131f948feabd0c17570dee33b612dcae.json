{"ast":null,"code":"import { ref, reactive, onMounted } from 'vue';\nimport { useRouter, useRoute } from 'vue-router';\nimport { communityService } from '../api/community';\nimport logger from '../utils/logger';\nexport default {\n  name: 'ContentDetail',\n  setup() {\n    const router = useRouter();\n    const route = useRoute();\n    const loading = ref(false);\n    const contentDetail = ref(null);\n    const comments = ref([]);\n    const newComment = ref('');\n    const posting = ref(false);\n    const showReplyForms = reactive({});\n    const replyContents = reactive({});\n    const replying = reactive({});\n    const replyTargets = reactive({});\n    const isReplyToReplies = reactive({});\n    const showImagePreview = ref(false);\n    const currentImage = ref('');\n    const imageList = ref([]);\n\n    // 确保响应式对象正确初始化\n    const ensureReactiveInit = () => {\n      if (typeof showReplyForms !== 'object' || showReplyForms === null) {\n        Object.assign(showReplyForms, {});\n      }\n      if (typeof replyContents !== 'object' || replyContents === null) {\n        Object.assign(replyContents, {});\n      }\n      if (typeof replying !== 'object' || replying === null) {\n        Object.assign(replying, {});\n      }\n    };\n\n    // 获取用户信息\n    const getUserInfo = () => {\n      try {\n        const storedUser = localStorage.getItem('user');\n        return storedUser ? JSON.parse(storedUser) : null;\n      } catch (error) {\n        logger.error('CONTENT_DETAIL', '获取用户信息失败', {}, error);\n        return null;\n      }\n    };\n\n    // 加载内容详情\n    const loadContentDetail = async () => {\n      const contentId = route.params.id;\n      if (!contentId) {\n        logger.error('CONTENT_DETAIL', '缺少内容ID');\n        router.push('/community');\n        return;\n      }\n      loading.value = true;\n      try {\n        logger.info('CONTENT_DETAIL', '加载内容详情', {\n          contentId\n        });\n        const detail = await communityService.getContentDetail(contentId);\n        contentDetail.value = detail;\n\n        // 加载评论列表\n        await loadComments(contentId);\n      } catch (error) {\n        logger.error('CONTENT_DETAIL', '加载内容详情失败', {\n          contentId\n        }, error);\n        alert(error.message || '加载内容失败，请稍后重试');\n        router.push('/community');\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 加载评论列表\n    const loadComments = async contentId => {\n      try {\n        logger.info('CONTENT_DETAIL', '加载评论列表', {\n          contentId\n        });\n        const data = await communityService.getCommentList(contentId);\n        comments.value = data.comments || [];\n        logger.info('CONTENT_DETAIL', '评论列表加载成功', {\n          count: comments.value.length\n        });\n      } catch (error) {\n        logger.error('CONTENT_DETAIL', '加载评论列表失败', {\n          contentId\n        }, error);\n        comments.value = [];\n      }\n    };\n\n    // 发表评论\n    const handlePostComment = async () => {\n      if (!newComment.value.trim()) {\n        alert('请输入评论内容');\n        return;\n      }\n      const userInfo = getUserInfo();\n      if (!userInfo || !userInfo.phone) {\n        alert('请先登录');\n        router.push('/login');\n        return;\n      }\n      posting.value = true;\n      const contentId = route.params.id;\n      try {\n        logger.userAction('POST_COMMENT', {\n          contentId\n        });\n        await communityService.postComment(contentId, {\n          comment: newComment.value.trim(),\n          phone: userInfo.phone\n        });\n        logger.info('CONTENT_DETAIL', '评论发表成功', {\n          contentId\n        });\n        newComment.value = '';\n        // 重新加载评论列表\n        await loadComments(contentId);\n      } catch (error) {\n        logger.error('CONTENT_DETAIL', '发表评论失败', {\n          contentId\n        }, error);\n        alert(error.message || '发表评论失败，请稍后重试');\n      } finally {\n        posting.value = false;\n      }\n    };\n\n    // 取消评论\n    const cancelComment = () => {\n      newComment.value = '';\n    };\n\n    // 切换回复表单\n    const toggleReplyForm = (commentId, targetAuthor = '', isReplyToReply = false) => {\n      showReplyForms[commentId] = !showReplyForms[commentId];\n      if (showReplyForms[commentId] && !replyContents[commentId]) {\n        replyContents[commentId] = '';\n      }\n\n      // 保存被回复者信息\n      if (showReplyForms[commentId]) {\n        replyTargets[commentId] = targetAuthor;\n        isReplyToReplies[commentId] = isReplyToReply;\n      }\n    };\n\n    // 发表回复\n    const handlePostReply = async (commentId, targetAuthor = '', replyId = null) => {\n      const targetId = replyId || commentId;\n      const replyContent = replyContents[targetId];\n      if (!replyContent || !replyContent.trim()) {\n        alert('请输入回复内容');\n        return;\n      }\n      const userInfo = getUserInfo();\n      if (!userInfo || !userInfo.phone) {\n        alert('请先登录');\n        router.push('/login');\n        return;\n      }\n      replying[targetId] = true;\n      const contentId = route.params.id;\n      try {\n        logger.userAction('POST_REPLY', {\n          commentId,\n          contentId,\n          targetAuthor,\n          replyId\n        });\n\n        // 构建回复内容，如果是回复别人的回复，则在内容前加上 @被回复者\n        let finalContent = replyContent.trim();\n        if (targetAuthor && replyId) {\n          finalContent = `@${targetAuthor} ${finalContent}`;\n        }\n        await communityService.postReply(commentId, {\n          comment: finalContent,\n          phone: userInfo.phone\n        });\n        logger.info('CONTENT_DETAIL', '回复发表成功', {\n          commentId,\n          targetAuthor\n        });\n        replyContents[targetId] = '';\n        showReplyForms[targetId] = false;\n        // 重新加载评论列表\n        await loadComments(contentId);\n      } catch (error) {\n        logger.error('CONTENT_DETAIL', '发表回复失败', {\n          commentId\n        }, error);\n        alert(error.message || '发表回复失败，请稍后重试');\n      } finally {\n        replying[targetId] = false;\n      }\n    };\n\n    // 取消回复\n    const cancelReply = commentId => {\n      replyContents[commentId] = '';\n      showReplyForms[commentId] = false;\n    };\n\n    // 返回\n    const goBack = () => {\n      router.push('/community');\n    };\n\n    // 格式化时间\n    const formatTime = timeStr => {\n      if (!timeStr) return '';\n      try {\n        const date = new Date(timeStr);\n        const now = new Date();\n        const diff = now - date;\n        const minutes = Math.floor(diff / 60000);\n        const hours = Math.floor(diff / 3600000);\n        const days = Math.floor(diff / 86400000);\n        if (minutes < 1) return '刚刚';\n        if (minutes < 60) return `${minutes}分钟前`;\n        if (hours < 24) return `${hours}小时前`;\n        if (days < 7) return `${days}天前`;\n        return date.toLocaleDateString('zh-CN');\n      } catch (error) {\n        return timeStr;\n      }\n    };\n\n    // 获取作者首字母（用于头像）\n    const getAuthorInitial = name => {\n      if (!name) return '?';\n      return name.charAt(0).toUpperCase();\n    };\n\n    // 获取类型标签\n    const getTypeLabel = type => {\n      const typeMap = {\n        articles: '文章',\n        questions: '提问',\n        experiences: '经验分享'\n      };\n      return typeMap[type] || type;\n    };\n\n    // 获取类型样式类\n    const getTypeClass = type => {\n      return `type-${type}`;\n    };\n\n    // 获取角色标签\n    const getRoleLabel = role => {\n      const roleMap = {\n        farmer: '农户',\n        expert: '专家',\n        buyer: '买家',\n        bank: '银行'\n      };\n      return roleMap[role] || role;\n    };\n\n    // 获取角色样式类\n    const getRoleClass = role => {\n      return `role-${role}`;\n    };\n\n    // 预览图片\n    const previewImage = (image, images) => {\n      currentImage.value = image;\n      imageList.value = images || [];\n      showImagePreview.value = true;\n    };\n\n    // 关闭图片预览\n    const closeImagePreview = () => {\n      showImagePreview.value = false;\n      currentImage.value = '';\n      imageList.value = [];\n    };\n    onMounted(() => {\n      logger.lifecycle('ContentDetail', 'mounted');\n      loadContentDetail();\n    });\n    return {\n      loading,\n      contentDetail,\n      comments,\n      newComment,\n      posting,\n      showReplyForms,\n      replyContents,\n      replying,\n      showImagePreview,\n      currentImage,\n      handlePostComment,\n      cancelComment,\n      toggleReplyForm,\n      handlePostReply,\n      cancelReply,\n      goBack,\n      formatTime,\n      getAuthorInitial,\n      getTypeLabel,\n      getTypeClass,\n      getRoleLabel,\n      getRoleClass,\n      previewImage,\n      closeImagePreview\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","useRouter","useRoute","communityService","logger","name","setup","router","route","loading","contentDetail","comments","newComment","posting","showReplyForms","replyContents","replying","replyTargets","isReplyToReplies","showImagePreview","currentImage","imageList","ensureReactiveInit","Object","assign","getUserInfo","storedUser","localStorage","getItem","JSON","parse","error","loadContentDetail","contentId","params","id","push","value","info","detail","getContentDetail","loadComments","alert","message","data","getCommentList","count","length","handlePostComment","trim","userInfo","phone","userAction","postComment","comment","cancelComment","toggleReplyForm","commentId","targetAuthor","isReplyToReply","handlePostReply","replyId","targetId","replyContent","finalContent","postReply","cancelReply","goBack","formatTime","timeStr","date","Date","now","diff","minutes","Math","floor","hours","days","toLocaleDateString","getAuthorInitial","charAt","toUpperCase","getTypeLabel","type","typeMap","articles","questions","experiences","getTypeClass","getRoleLabel","role","roleMap","farmer","expert","buyer","bank","getRoleClass","previewImage","image","images","closeImagePreview","lifecycle"],"sources":["D:\\STUDY\\FarmerHappy\\farmer_happy\\src\\community\\ContentDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"content-detail-container\">\r\n    <!-- 顶部导航栏 -->\r\n    <header class=\"header\">\r\n      <button class=\"btn-back\" @click=\"goBack\">\r\n        <span class=\"back-icon\">←</span>\r\n        返回\r\n      </button>\r\n      <h1 class=\"header-title\">内容详情</h1>\r\n      <div class=\"header-placeholder\"></div>\r\n    </header>\r\n\r\n    <!-- 加载状态 -->\r\n    <div v-if=\"loading\" class=\"loading-state\">\r\n      <div class=\"loading-spinner\"></div>\r\n      <p>加载中...</p>\r\n    </div>\r\n\r\n    <!-- 内容详情 -->\r\n    <div v-else-if=\"contentDetail\" class=\"detail-wrapper\">\r\n      <main class=\"main-content\">\r\n        <!-- 内容主体 -->\r\n        <article class=\"content-article\">\r\n          <div class=\"content-header\">\r\n            <div class=\"content-type-badge\" :class=\"getTypeClass(contentDetail.content_type)\">\r\n              {{ getTypeLabel(contentDetail.content_type) }}\r\n            </div>\r\n            <div class=\"content-meta\">\r\n              <span class=\"author\">\r\n                <span class=\"author-icon\">👤</span>\r\n                {{ contentDetail.author_name || contentDetail.author_nickname }}\r\n              </span>\r\n              <span class=\"role-badge\" :class=\"getRoleClass(contentDetail.author_role)\">\r\n                {{ getRoleLabel(contentDetail.author_role) }}\r\n              </span>\r\n              <span class=\"time\">{{ formatTime(contentDetail.created_at) }}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <h1 class=\"article-title\">{{ contentDetail.title }}</h1>\r\n\r\n          <div class=\"article-content\">{{ contentDetail.content }}</div>\r\n\r\n          <div v-if=\"contentDetail.images && contentDetail.images.length > 0\" class=\"article-images\">\r\n            <img\r\n              v-for=\"(image, idx) in contentDetail.images\"\r\n              :key=\"idx\"\r\n              :src=\"image\"\r\n              :alt=\"`图片${idx + 1}`\"\r\n              class=\"article-image\"\r\n              @click=\"previewImage(image, contentDetail.images)\"\r\n            />\r\n          </div>\r\n\r\n          <div class=\"article-stats\">\r\n            <span class=\"stat-item\">\r\n              <span class=\"stat-icon\">👁</span>\r\n              {{ contentDetail.view_count || 0 }} 浏览\r\n            </span>\r\n            <span class=\"stat-item\">\r\n              <span class=\"stat-icon\">💬</span>\r\n              {{ contentDetail.comment_count || 0 }} 评论\r\n            </span>\r\n          </div>\r\n        </article>\r\n\r\n        <!-- 评论区域 -->\r\n        <section class=\"comments-section\">\r\n          <div class=\"section-header\">\r\n            <h2 class=\"section-title\">\r\n              <span class=\"title-icon\">💬</span>\r\n              评论 ({{ comments.length }})\r\n            </h2>\r\n          </div>\r\n\r\n          <!-- 发表评论表单 -->\r\n          <div class=\"comment-form\">\r\n            <textarea\r\n              v-model=\"newComment\"\r\n              class=\"comment-input\"\r\n              placeholder=\"写下你的评论...\"\r\n              rows=\"3\"\r\n            ></textarea>\r\n            <div class=\"comment-actions\">\r\n              <button class=\"btn-cancel\" @click=\"cancelComment\">取消</button>\r\n              <button class=\"btn-submit\" @click=\"handlePostComment\" :disabled=\"posting\">\r\n                {{ posting ? '提交中...' : '发表评论' }}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- 评论列表 -->\r\n          <div class=\"comments-list\" v-if=\"comments.length > 0\">\r\n            <div\r\n              v-for=\"comment in comments\"\r\n              :key=\"comment.comment_id\"\r\n              class=\"comment-item\"\r\n            >\r\n              <div class=\"comment-header\">\r\n                <div class=\"comment-author\">\r\n                  <span class=\"author-avatar\">{{ getAuthorInitial(comment.author_nickname) }}</span>\r\n                  <div class=\"author-info\">\r\n                    <span class=\"author-name\">{{ comment.author_nickname }}</span>\r\n                    <span class=\"author-role-badge\" :class=\"getRoleClass(comment.author_role)\">\r\n                      {{ getRoleLabel(comment.author_role) }}\r\n                    </span>\r\n                  </div>\r\n                  <span class=\"comment-time\">{{ formatTime(comment.created_at) }}</span>\r\n                </div>\r\n                <button class=\"btn-reply\" @click=\"toggleReplyForm(comment.comment_id, comment.author_nickname)\">\r\n                  <span class=\"reply-icon\">↩</span>\r\n                  回复\r\n                </button>\r\n              </div>\r\n\r\n              <div class=\"comment-content\">{{ comment.content }}</div>\r\n\r\n              <!-- 回复表单 -->\r\n              <div v-if=\"showReplyForms[comment.comment_id]\" class=\"reply-form\">\r\n                <textarea\r\n                  v-model=\"replyContents[comment.comment_id]\"\r\n                  class=\"reply-input\"\r\n                  :placeholder=\"`回复 @${comment.author_nickname}...`\"\r\n                  rows=\"2\"\r\n                ></textarea>\r\n                <div class=\"reply-actions\">\r\n                  <button class=\"btn-cancel\" @click=\"cancelReply(comment.comment_id)\">取消</button>\r\n                  <button\r\n                    class=\"btn-submit\"\r\n                    @click=\"handlePostReply(comment.comment_id)\"\r\n                    :disabled=\"replying[comment.comment_id]\"\r\n                  >\r\n                    {{ replying[comment.comment_id] ? '回复中...' : '发表回复' }}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <!-- 回复列表 -->\r\n              <div v-if=\"comment.replies && comment.replies.length > 0\" class=\"replies-list\">\r\n                <div\r\n                  v-for=\"reply in comment.replies\"\r\n                  :key=\"reply.reply_id\"\r\n                  class=\"reply-item\"\r\n                >\r\n                  <div class=\"reply-header\">\r\n                    <div class=\"reply-meta\">\r\n                      <span class=\"reply-author\">{{ reply.author_nickname }}</span>\r\n                      <span class=\"author-role-badge small\" :class=\"getRoleClass(reply.author_role)\">\r\n                        {{ getRoleLabel(reply.author_role) }}\r\n                      </span>\r\n                      <span class=\"reply-target\">回复 @{{ comment.author_nickname }}：</span>\r\n                      <span class=\"reply-time\">{{ formatTime(reply.created_at) }}</span>\r\n                    </div>\r\n                    <button class=\"btn-reply-small\" @click=\"toggleReplyForm(reply.reply_id, reply.author_nickname, true)\">\r\n                      <span class=\"reply-icon\">↩</span>\r\n                      回复\r\n                    </button>\r\n                  </div>\r\n                  <div class=\"reply-content\">{{ reply.content }}</div>\r\n                  \r\n                  <!-- 回复的回复表单 -->\r\n                  <div v-if=\"showReplyForms[reply.reply_id]\" class=\"reply-form\">\r\n                    <textarea\r\n                      v-model=\"replyContents[reply.reply_id]\"\r\n                      class=\"reply-input\"\r\n                      :placeholder=\"`回复 @${reply.author_nickname}...`\"\r\n                      rows=\"2\"\r\n                    ></textarea>\r\n                    <div class=\"reply-actions\">\r\n                      <button class=\"btn-cancel\" @click=\"cancelReply(reply.reply_id)\">取消</button>\r\n                      <button\r\n                        class=\"btn-submit\"\r\n                        @click=\"handlePostReply(comment.comment_id, reply.author_nickname, reply.reply_id)\"\r\n                        :disabled=\"replying[reply.reply_id]\"\r\n                      >\r\n                        {{ replying[reply.reply_id] ? '回复中...' : '发表回复' }}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- 无评论状态 -->\r\n          <div v-else class=\"empty-comments\">\r\n            <div class=\"empty-icon\">💭</div>\r\n            <p class=\"empty-text\">还没有评论，快来抢沙发吧！</p>\r\n          </div>\r\n        </section>\r\n      </main>\r\n    </div>\r\n\r\n    <!-- 图片预览模态框 -->\r\n    <div v-if=\"showImagePreview\" class=\"image-preview-modal\" @click=\"closeImagePreview\">\r\n      <img :src=\"currentImage\" :alt=\"'预览图片'\" class=\"preview-image\" @click.stop />\r\n      <button class=\"close-preview\" @click=\"closeImagePreview\">×</button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, onMounted } from 'vue';\r\nimport { useRouter, useRoute } from 'vue-router';\r\nimport { communityService } from '../api/community';\r\nimport logger from '../utils/logger';\r\n\r\nexport default {\r\n  name: 'ContentDetail',\r\n  setup() {\r\n    const router = useRouter();\r\n    const route = useRoute();\r\n    const loading = ref(false);\r\n    const contentDetail = ref(null);\r\n    const comments = ref([]);\r\n    const newComment = ref('');\r\n    const posting = ref(false);\r\n    const showReplyForms = reactive({});\r\n    const replyContents = reactive({});\r\n    const replying = reactive({});\r\n    const replyTargets = reactive({});\r\n    const isReplyToReplies = reactive({});\r\n    const showImagePreview = ref(false);\r\n    const currentImage = ref('');\r\n    const imageList = ref([]);\r\n\r\n    // 确保响应式对象正确初始化\r\n    const ensureReactiveInit = () => {\r\n      if (typeof showReplyForms !== 'object' || showReplyForms === null) {\r\n        Object.assign(showReplyForms, {});\r\n      }\r\n      if (typeof replyContents !== 'object' || replyContents === null) {\r\n        Object.assign(replyContents, {});\r\n      }\r\n      if (typeof replying !== 'object' || replying === null) {\r\n        Object.assign(replying, {});\r\n      }\r\n    };\r\n\r\n    // 获取用户信息\r\n    const getUserInfo = () => {\r\n      try {\r\n        const storedUser = localStorage.getItem('user');\r\n        return storedUser ? JSON.parse(storedUser) : null;\r\n      } catch (error) {\r\n        logger.error('CONTENT_DETAIL', '获取用户信息失败', {}, error);\r\n        return null;\r\n      }\r\n    };\r\n\r\n    // 加载内容详情\r\n    const loadContentDetail = async () => {\r\n      const contentId = route.params.id;\r\n      if (!contentId) {\r\n        logger.error('CONTENT_DETAIL', '缺少内容ID');\r\n        router.push('/community');\r\n        return;\r\n      }\r\n\r\n      loading.value = true;\r\n      try {\r\n        logger.info('CONTENT_DETAIL', '加载内容详情', { contentId });\r\n        const detail = await communityService.getContentDetail(contentId);\r\n        contentDetail.value = detail;\r\n        \r\n        // 加载评论列表\r\n        await loadComments(contentId);\r\n      } catch (error) {\r\n        logger.error('CONTENT_DETAIL', '加载内容详情失败', { contentId }, error);\r\n        alert(error.message || '加载内容失败，请稍后重试');\r\n        router.push('/community');\r\n      } finally {\r\n        loading.value = false;\r\n      }\r\n    };\r\n\r\n    // 加载评论列表\r\n    const loadComments = async (contentId) => {\r\n      try {\r\n        logger.info('CONTENT_DETAIL', '加载评论列表', { contentId });\r\n        const data = await communityService.getCommentList(contentId);\r\n        comments.value = data.comments || [];\r\n        logger.info('CONTENT_DETAIL', '评论列表加载成功', { count: comments.value.length });\r\n      } catch (error) {\r\n        logger.error('CONTENT_DETAIL', '加载评论列表失败', { contentId }, error);\r\n        comments.value = [];\r\n      }\r\n    };\r\n\r\n    // 发表评论\r\n    const handlePostComment = async () => {\r\n      if (!newComment.value.trim()) {\r\n        alert('请输入评论内容');\r\n        return;\r\n      }\r\n\r\n      const userInfo = getUserInfo();\r\n      if (!userInfo || !userInfo.phone) {\r\n        alert('请先登录');\r\n        router.push('/login');\r\n        return;\r\n      }\r\n\r\n      posting.value = true;\r\n      const contentId = route.params.id;\r\n\r\n      try {\r\n        logger.userAction('POST_COMMENT', { contentId });\r\n        await communityService.postComment(contentId, {\r\n          comment: newComment.value.trim(),\r\n          phone: userInfo.phone\r\n        });\r\n\r\n        logger.info('CONTENT_DETAIL', '评论发表成功', { contentId });\r\n        newComment.value = '';\r\n        // 重新加载评论列表\r\n        await loadComments(contentId);\r\n      } catch (error) {\r\n        logger.error('CONTENT_DETAIL', '发表评论失败', { contentId }, error);\r\n        alert(error.message || '发表评论失败，请稍后重试');\r\n      } finally {\r\n        posting.value = false;\r\n      }\r\n    };\r\n\r\n    // 取消评论\r\n    const cancelComment = () => {\r\n      newComment.value = '';\r\n    };\r\n\r\n    // 切换回复表单\r\n    const toggleReplyForm = (commentId, targetAuthor = '', isReplyToReply = false) => {\r\n      showReplyForms[commentId] = !showReplyForms[commentId];\r\n      if (showReplyForms[commentId] && !replyContents[commentId]) {\r\n        replyContents[commentId] = '';\r\n      }\r\n      \r\n      // 保存被回复者信息\r\n      if (showReplyForms[commentId]) {\r\n        replyTargets[commentId] = targetAuthor;\r\n        isReplyToReplies[commentId] = isReplyToReply;\r\n      }\r\n    };\r\n\r\n    // 发表回复\r\n    const handlePostReply = async (commentId, targetAuthor = '', replyId = null) => {\r\n      const targetId = replyId || commentId;\r\n      const replyContent = replyContents[targetId];\r\n      if (!replyContent || !replyContent.trim()) {\r\n        alert('请输入回复内容');\r\n        return;\r\n      }\r\n\r\n      const userInfo = getUserInfo();\r\n      if (!userInfo || !userInfo.phone) {\r\n        alert('请先登录');\r\n        router.push('/login');\r\n        return;\r\n      }\r\n\r\n      replying[targetId] = true;\r\n      const contentId = route.params.id;\r\n\r\n      try {\r\n        logger.userAction('POST_REPLY', { commentId, contentId, targetAuthor, replyId });\r\n        \r\n        // 构建回复内容，如果是回复别人的回复，则在内容前加上 @被回复者\r\n        let finalContent = replyContent.trim();\r\n        if (targetAuthor && replyId) {\r\n          finalContent = `@${targetAuthor} ${finalContent}`;\r\n        }\r\n        \r\n        await communityService.postReply(commentId, {\r\n          comment: finalContent,\r\n          phone: userInfo.phone\r\n        });\r\n\r\n        logger.info('CONTENT_DETAIL', '回复发表成功', { commentId, targetAuthor });\r\n        replyContents[targetId] = '';\r\n        showReplyForms[targetId] = false;\r\n        // 重新加载评论列表\r\n        await loadComments(contentId);\r\n      } catch (error) {\r\n        logger.error('CONTENT_DETAIL', '发表回复失败', { commentId }, error);\r\n        alert(error.message || '发表回复失败，请稍后重试');\r\n      } finally {\r\n        replying[targetId] = false;\r\n      }\r\n    };\r\n\r\n    // 取消回复\r\n    const cancelReply = (commentId) => {\r\n      replyContents[commentId] = '';\r\n      showReplyForms[commentId] = false;\r\n    };\r\n\r\n    // 返回\r\n    const goBack = () => {\r\n      router.push('/community');\r\n    };\r\n\r\n    // 格式化时间\r\n    const formatTime = (timeStr) => {\r\n      if (!timeStr) return '';\r\n      try {\r\n        const date = new Date(timeStr);\r\n        const now = new Date();\r\n        const diff = now - date;\r\n        const minutes = Math.floor(diff / 60000);\r\n        const hours = Math.floor(diff / 3600000);\r\n        const days = Math.floor(diff / 86400000);\r\n\r\n        if (minutes < 1) return '刚刚';\r\n        if (minutes < 60) return `${minutes}分钟前`;\r\n        if (hours < 24) return `${hours}小时前`;\r\n        if (days < 7) return `${days}天前`;\r\n        return date.toLocaleDateString('zh-CN');\r\n      } catch (error) {\r\n        return timeStr;\r\n      }\r\n    };\r\n\r\n    // 获取作者首字母（用于头像）\r\n    const getAuthorInitial = (name) => {\r\n      if (!name) return '?';\r\n      return name.charAt(0).toUpperCase();\r\n    };\r\n\r\n    // 获取类型标签\r\n    const getTypeLabel = (type) => {\r\n      const typeMap = {\r\n        articles: '文章',\r\n        questions: '提问',\r\n        experiences: '经验分享'\r\n      };\r\n      return typeMap[type] || type;\r\n    };\r\n\r\n    // 获取类型样式类\r\n    const getTypeClass = (type) => {\r\n      return `type-${type}`;\r\n    };\r\n\r\n    // 获取角色标签\r\n    const getRoleLabel = (role) => {\r\n      const roleMap = {\r\n        farmer: '农户',\r\n        expert: '专家',\r\n        buyer: '买家',\r\n        bank: '银行'\r\n      };\r\n      return roleMap[role] || role;\r\n    };\r\n\r\n    // 获取角色样式类\r\n    const getRoleClass = (role) => {\r\n      return `role-${role}`;\r\n    };\r\n\r\n    // 预览图片\r\n    const previewImage = (image, images) => {\r\n      currentImage.value = image;\r\n      imageList.value = images || [];\r\n      showImagePreview.value = true;\r\n    };\r\n\r\n    // 关闭图片预览\r\n    const closeImagePreview = () => {\r\n      showImagePreview.value = false;\r\n      currentImage.value = '';\r\n      imageList.value = [];\r\n    };\r\n\r\n    onMounted(() => {\r\n      logger.lifecycle('ContentDetail', 'mounted');\r\n      loadContentDetail();\r\n    });\r\n\r\n    return {\r\n      loading,\r\n      contentDetail,\r\n      comments,\r\n      newComment,\r\n      posting,\r\n      showReplyForms,\r\n      replyContents,\r\n      replying,\r\n      showImagePreview,\r\n      currentImage,\r\n      handlePostComment,\r\n      cancelComment,\r\n      toggleReplyForm,\r\n      handlePostReply,\r\n      cancelReply,\r\n      goBack,\r\n      formatTime,\r\n      getAuthorInitial,\r\n      getTypeLabel,\r\n      getTypeClass,\r\n      getRoleLabel,\r\n      getRoleClass,\r\n      previewImage,\r\n      closeImagePreview\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n@import '../assets/styles/theme.css';\r\n\r\n.content-detail-container {\r\n  min-height: 100vh;\r\n  background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);\r\n}\r\n\r\n/* 顶部导航栏 */\r\n.header {\r\n  background: var(--white);\r\n  padding: 1rem 2rem;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.1);\r\n  position: sticky;\r\n  top: 0;\r\n  z-index: 100;\r\n}\r\n\r\n.btn-back {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  padding: 0.5rem 1rem;\r\n  background: transparent;\r\n  border: 1px solid var(--gray-300);\r\n  border-radius: 8px;\r\n  color: var(--gray-600);\r\n  font-size: 0.875rem;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.btn-back:hover {\r\n  background: var(--gray-100);\r\n  border-color: var(--primary);\r\n  color: var(--primary);\r\n}\r\n\r\n.header-title {\r\n  font-size: 1.5rem;\r\n  font-weight: 700;\r\n  color: var(--primary);\r\n  margin: 0;\r\n}\r\n\r\n.header-placeholder {\r\n  width: 120px;\r\n}\r\n\r\n/* 加载状态 */\r\n.loading-state {\r\n  text-align: center;\r\n  padding: 4rem 2rem;\r\n  background: var(--white);\r\n  margin: 2rem auto;\r\n  max-width: 1200px;\r\n  border-radius: 16px;\r\n}\r\n\r\n.loading-spinner {\r\n  width: 48px;\r\n  height: 48px;\r\n  border: 4px solid var(--gray-200);\r\n  border-top-color: var(--primary);\r\n  border-radius: 50%;\r\n  animation: spin 1s linear infinite;\r\n  margin: 0 auto 1rem;\r\n}\r\n\r\n@keyframes spin {\r\n  to { transform: rotate(360deg); }\r\n}\r\n\r\n/* 主内容 */\r\n.detail-wrapper {\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n  padding: 2rem;\r\n}\r\n\r\n.main-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 2rem;\r\n}\r\n\r\n/* 内容文章 */\r\n.content-article {\r\n  background: var(--white);\r\n  padding: 2rem;\r\n  border-radius: 16px;\r\n  box-shadow: 0 4px 12px rgba(107, 70, 193, 0.08);\r\n}\r\n\r\n.content-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 1.5rem;\r\n  flex-wrap: wrap;\r\n  gap: 1rem;\r\n}\r\n\r\n.content-type-badge {\r\n  padding: 0.5rem 1rem;\r\n  border-radius: 8px;\r\n  font-size: 0.875rem;\r\n  font-weight: 600;\r\n  color: var(--white);\r\n}\r\n\r\n.type-articles {\r\n  background: linear-gradient(135deg, #8B5CF6, #A78BFA);\r\n}\r\n\r\n.type-questions {\r\n  background: linear-gradient(135deg, #EC4899, #F472B6);\r\n}\r\n\r\n.type-experiences {\r\n  background: linear-gradient(135deg, #06B6D4, #22D3EE);\r\n}\r\n\r\n.content-meta {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 1rem;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.author {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.375rem;\r\n  color: var(--gray-600);\r\n  font-size: 0.9375rem;\r\n}\r\n\r\n.author-icon {\r\n  font-size: 1.125rem;\r\n}\r\n\r\n.role-badge {\r\n  padding: 0.375rem 0.875rem;\r\n  border-radius: 6px;\r\n  font-size: 0.75rem;\r\n  font-weight: 600;\r\n  color: var(--white);\r\n}\r\n\r\n.role-farmer {\r\n  background: linear-gradient(135deg, #10B981, #34D399);\r\n}\r\n\r\n.role-expert {\r\n  background: linear-gradient(135deg, var(--primary), var(--primary-light));\r\n}\r\n\r\n.role-buyer {\r\n  background: linear-gradient(135deg, #F59E0B, #FBBF24);\r\n}\r\n\r\n.role-bank {\r\n  background: linear-gradient(135deg, #6366F1, #818CF8);\r\n}\r\n\r\n.time {\r\n  color: var(--gray-500);\r\n  font-size: 0.875rem;\r\n}\r\n\r\n.article-title {\r\n  font-size: 2rem;\r\n  font-weight: 700;\r\n  color: #1a202c;\r\n  margin: 0 0 1.5rem 0;\r\n  line-height: 1.4;\r\n}\r\n\r\n.article-content {\r\n  font-size: 1.125rem;\r\n  line-height: 1.8;\r\n  color: #374151;\r\n  white-space: pre-wrap;\r\n  word-wrap: break-word;\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.article-images {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 1rem;\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.article-image {\r\n  max-width: 100%;\r\n  max-height: 400px;\r\n  object-fit: contain;\r\n  border-radius: 12px;\r\n  cursor: pointer;\r\n  transition: transform 0.2s;\r\n}\r\n\r\n.article-image:hover {\r\n  transform: scale(1.02);\r\n}\r\n\r\n.article-stats {\r\n  display: flex;\r\n  gap: 2rem;\r\n  padding-top: 1.5rem;\r\n  border-top: 1px solid var(--gray-200);\r\n  color: var(--gray-500);\r\n  font-size: 0.9375rem;\r\n}\r\n\r\n.stat-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.stat-icon {\r\n  font-size: 1.125rem;\r\n}\r\n\r\n/* 评论区域 */\r\n.comments-section {\r\n  background: var(--white);\r\n  padding: 2rem;\r\n  border-radius: 16px;\r\n  box-shadow: 0 4px 12px rgba(107, 70, 193, 0.08);\r\n}\r\n\r\n.section-header {\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.section-title {\r\n  font-size: 1.5rem;\r\n  font-weight: 700;\r\n  color: #1a202c;\r\n  margin: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.title-icon {\r\n  font-size: 1.5rem;\r\n}\r\n\r\n/* 评论表单 */\r\n.comment-form {\r\n  margin-bottom: 2rem;\r\n  padding-bottom: 2rem;\r\n  border-bottom: 2px solid var(--gray-200);\r\n}\r\n\r\n.comment-input {\r\n  width: 100%;\r\n  padding: 1rem;\r\n  border: 2px solid var(--gray-300);\r\n  border-radius: 12px;\r\n  font-size: 1rem;\r\n  font-family: inherit;\r\n  resize: vertical;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.comment-input:focus {\r\n  outline: none;\r\n  border-color: var(--primary);\r\n  box-shadow: 0 0 0 3px rgba(107, 70, 193, 0.1);\r\n}\r\n\r\n.comment-actions {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 1rem;\r\n  margin-top: 1rem;\r\n}\r\n\r\n/* 评论列表 */\r\n.comments-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 1.5rem;\r\n}\r\n\r\n.comment-item {\r\n  padding-bottom: 1.5rem;\r\n  border-bottom: 1px solid var(--gray-200);\r\n}\r\n\r\n.comment-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.comment-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 0.75rem;\r\n}\r\n\r\n.comment-author {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.75rem;\r\n  flex: 1;\r\n}\r\n\r\n.author-avatar {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  background: linear-gradient(135deg, var(--primary), var(--primary-light));\r\n  color: var(--white);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-weight: 600;\r\n  font-size: 1rem;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.author-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.25rem;\r\n  min-width: 0;\r\n}\r\n\r\n.comment-time {\r\n  color: var(--gray-500);\r\n  font-size: 0.875rem;\r\n  margin-left: auto;\r\n}\r\n\r\n.author-name {\r\n  font-weight: 600;\r\n  color: #1a202c;\r\n  font-size: 0.9375rem;\r\n}\r\n\r\n.author-role-badge {\r\n  padding: 0.125rem 0.5rem;\r\n  border-radius: 4px;\r\n  font-size: 0.625rem;\r\n  font-weight: 600;\r\n  color: var(--white);\r\n  width: fit-content;\r\n}\r\n\r\n.author-role-badge.small {\r\n  padding: 0.125rem 0.375rem;\r\n  font-size: 0.5625rem;\r\n}\r\n\r\n.comment-time {\r\n  color: var(--gray-500);\r\n  font-size: 0.875rem;\r\n}\r\n\r\n.comment-content {\r\n  color: #374151;\r\n  line-height: 1.6;\r\n  margin-bottom: 0.75rem;\r\n  white-space: pre-wrap;\r\n  word-wrap: break-word;\r\n}\r\n\r\n.btn-reply {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.375rem;\r\n  padding: 0.5rem 1rem;\r\n  background: transparent;\r\n  border: 1px solid var(--gray-300);\r\n  border-radius: 6px;\r\n  color: var(--gray-600);\r\n  font-size: 0.875rem;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.btn-reply:hover {\r\n  background: var(--gray-100);\r\n  border-color: var(--primary);\r\n  color: var(--primary);\r\n}\r\n\r\n.reply-icon {\r\n  font-size: 1rem;\r\n}\r\n\r\n/* 回复表单 */\r\n.reply-form {\r\n  margin-top: 1rem;\r\n  padding: 1rem;\r\n  background: var(--gray-100);\r\n  border-radius: 8px;\r\n}\r\n\r\n.reply-input {\r\n  width: 100%;\r\n  padding: 0.75rem;\r\n  border: 2px solid var(--gray-300);\r\n  border-radius: 8px;\r\n  font-size: 0.9375rem;\r\n  font-family: inherit;\r\n  resize: vertical;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.reply-input:focus {\r\n  outline: none;\r\n  border-color: var(--primary);\r\n  box-shadow: 0 0 0 3px rgba(107, 70, 193, 0.1);\r\n}\r\n\r\n.reply-actions {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 1rem;\r\n  margin-top: 0.75rem;\r\n}\r\n\r\n/* 回复列表 */\r\n.replies-list {\r\n  margin-top: 1rem;\r\n  padding-left: 1rem;\r\n  border-left: 2px solid var(--gray-200);\r\n  background: var(--gray-50);\r\n  border-radius: 0 0 8px 8px;\r\n}\r\n\r\n.reply-item {\r\n  padding: 0.75rem;\r\n  border-bottom: 1px solid var(--gray-200);\r\n  position: relative;\r\n}\r\n\r\n.reply-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.reply-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.reply-meta {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.reply-author {\r\n  font-weight: 600;\r\n  color: #1a202c;\r\n  font-size: 0.9375rem;\r\n}\r\n\r\n.reply-target {\r\n  color: var(--gray-600);\r\n  font-size: 0.875rem;\r\n}\r\n\r\n.btn-reply-small {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.25rem;\r\n  padding: 0.375rem 0.75rem;\r\n  background: transparent;\r\n  border: 1px solid var(--gray-300);\r\n  border-radius: 4px;\r\n  color: var(--gray-600);\r\n  font-size: 0.75rem;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.btn-reply-small:hover {\r\n  background: var(--gray-100);\r\n  border-color: var(--primary);\r\n  color: var(--primary);\r\n}\r\n\r\n.reply-time {\r\n  color: var(--gray-500);\r\n  font-size: 0.8125rem;\r\n}\r\n\r\n.reply-content {\r\n  color: #4B5563;\r\n  line-height: 1.6;\r\n  font-size: 0.9375rem;\r\n  white-space: pre-wrap;\r\n  word-wrap: break-word;\r\n}\r\n\r\n/* 按钮样式 */\r\n.btn-cancel,\r\n.btn-submit {\r\n  padding: 0.625rem 1.25rem;\r\n  border: none;\r\n  border-radius: 8px;\r\n  font-size: 0.9375rem;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.btn-cancel {\r\n  background: var(--gray-200);\r\n  color: var(--gray-600);\r\n}\r\n\r\n.btn-cancel:hover {\r\n  background: var(--gray-300);\r\n}\r\n\r\n.btn-submit {\r\n  background: linear-gradient(135deg, var(--primary), var(--primary-light));\r\n  color: var(--white);\r\n}\r\n\r\n.btn-submit:hover:not(:disabled) {\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(107, 70, 193, 0.3);\r\n}\r\n\r\n.btn-submit:disabled {\r\n  opacity: 0.6;\r\n  cursor: not-allowed;\r\n}\r\n\r\n/* 空评论状态 */\r\n.empty-comments {\r\n  text-align: center;\r\n  padding: 3rem 2rem;\r\n}\r\n\r\n.empty-icon {\r\n  font-size: 3rem;\r\n  margin-bottom: 1rem;\r\n}\r\n\r\n.empty-text {\r\n  color: var(--gray-500);\r\n  font-size: 1rem;\r\n}\r\n\r\n/* 图片预览模态框 */\r\n.image-preview-modal {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.9);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n  cursor: pointer;\r\n}\r\n\r\n.preview-image {\r\n  max-width: 90%;\r\n  max-height: 90%;\r\n  object-fit: contain;\r\n  border-radius: 8px;\r\n}\r\n\r\n.close-preview {\r\n  position: absolute;\r\n  top: 2rem;\r\n  right: 2rem;\r\n  width: 48px;\r\n  height: 48px;\r\n  background: rgba(255, 255, 255, 0.2);\r\n  border: none;\r\n  border-radius: 50%;\r\n  color: var(--white);\r\n  font-size: 2rem;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.close-preview:hover {\r\n  background: rgba(255, 255, 255, 0.3);\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 768px) {\r\n  .header {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .header-title {\r\n    font-size: 1.25rem;\r\n  }\r\n\r\n  .detail-wrapper {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .content-article,\r\n  .comments-section {\r\n    padding: 1.5rem;\r\n  }\r\n\r\n  .article-title {\r\n    font-size: 1.5rem;\r\n  }\r\n\r\n  .article-content {\r\n    font-size: 1rem;\r\n  }\r\n}\r\n</style>\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}