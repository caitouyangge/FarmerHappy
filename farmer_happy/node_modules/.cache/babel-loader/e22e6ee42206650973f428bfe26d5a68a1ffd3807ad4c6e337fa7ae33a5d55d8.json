{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, vModelText as _vModelText, normalizeClass as _normalizeClass, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, vModelSelect as _vModelSelect, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"modal-header\"\n};\nconst _hoisted_2 = {\n  class: \"modal-title\"\n};\nconst _hoisted_3 = {\n  class: \"form-content\"\n};\nconst _hoisted_4 = {\n  class: \"form-section\"\n};\nconst _hoisted_5 = {\n  class: \"form-group\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"form-error\"\n};\nconst _hoisted_7 = {\n  class: \"form-group\"\n};\nconst _hoisted_8 = {\n  key: 0,\n  class: \"form-error\"\n};\nconst _hoisted_9 = {\n  class: \"form-group\"\n};\nconst _hoisted_10 = {\n  key: 0,\n  class: \"form-error\"\n};\nconst _hoisted_11 = {\n  class: \"form-section\"\n};\nconst _hoisted_12 = {\n  class: \"form-row\"\n};\nconst _hoisted_13 = {\n  class: \"form-group\"\n};\nconst _hoisted_14 = {\n  key: 0,\n  class: \"form-error\"\n};\nconst _hoisted_15 = {\n  class: \"form-group\"\n};\nconst _hoisted_16 = {\n  key: 0,\n  class: \"form-error\"\n};\nconst _hoisted_17 = {\n  class: \"form-section\"\n};\nconst _hoisted_18 = {\n  class: \"form-row\"\n};\nconst _hoisted_19 = {\n  class: \"form-group\"\n};\nconst _hoisted_20 = {\n  key: 0,\n  class: \"form-error\"\n};\nconst _hoisted_21 = {\n  class: \"form-group\"\n};\nconst _hoisted_22 = {\n  key: 0,\n  class: \"form-error\"\n};\nconst _hoisted_23 = {\n  class: \"form-group\"\n};\nconst _hoisted_24 = {\n  key: 0,\n  class: \"form-error\"\n};\nconst _hoisted_25 = {\n  class: \"modal-footer\"\n};\nconst _hoisted_26 = [\"disabled\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: \"modal-overlay\",\n    onClick: _cache[12] || (_cache[12] = (...args) => $setup.handleOverlayClick && $setup.handleOverlayClick(...args))\n  }, [_createElementVNode(\"div\", {\n    class: \"modal-container\",\n    onClick: _cache[11] || (_cache[11] = _withModifiers(() => {}, [\"stop\"]))\n  }, [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"h2\", _hoisted_2, _toDisplayString($props.isEdit ? '编辑农产品' : '发布农产品'), 1 /* TEXT */), _createElementVNode(\"button\", {\n    class: \"close-btn\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $setup.handleClose && $setup.handleClose(...args))\n  }, [...(_cache[13] || (_cache[13] = [_createElementVNode(\"span\", {\n    class: \"close-icon\"\n  }, \"×\", -1 /* CACHED */)]))])]), _createElementVNode(\"form\", {\n    onSubmit: _cache[10] || (_cache[10] = _withModifiers((...args) => $setup.handleSubmit && $setup.handleSubmit(...args), [\"prevent\"])),\n    class: \"modal-form\"\n  }, [_createElementVNode(\"div\", _hoisted_3, [_createCommentVNode(\" 基本信息 \"), _createElementVNode(\"div\", _hoisted_4, [_cache[18] || (_cache[18] = _createElementVNode(\"h3\", {\n    class: \"section-title\"\n  }, \"基本信息\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_5, [_cache[14] || (_cache[14] = _createElementVNode(\"label\", {\n    class: \"form-label required\"\n  }, \"产品标题\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.form.title = $event),\n    type: \"text\",\n    class: _normalizeClass([\"form-input\", {\n      'error': $setup.errors.title\n    }]),\n    placeholder: \"请输入产品标题\",\n    maxlength: \"100\"\n  }, null, 2 /* CLASS */), [[_vModelText, $setup.form.title]]), $setup.errors.title ? (_openBlock(), _createElementBlock(\"span\", _hoisted_6, _toDisplayString($setup.errors.title), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_7, [_cache[16] || (_cache[16] = _createElementVNode(\"label\", {\n    class: \"form-label required\"\n  }, \"产品分类\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.form.category = $event),\n    class: _normalizeClass([\"form-input\", {\n      'error': $setup.errors.category\n    }])\n  }, [...(_cache[15] || (_cache[15] = [_createElementVNode(\"option\", {\n    value: \"\"\n  }, \"请选择产品分类\", -1 /* CACHED */), _createElementVNode(\"option\", {\n    value: \"vegetables\"\n  }, \"蔬菜\", -1 /* CACHED */), _createElementVNode(\"option\", {\n    value: \"fruits\"\n  }, \"水果\", -1 /* CACHED */), _createElementVNode(\"option\", {\n    value: \"grains\"\n  }, \"粮食\", -1 /* CACHED */)]))], 2 /* CLASS */), [[_vModelSelect, $setup.form.category]]), $setup.errors.category ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, _toDisplayString($setup.errors.category), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_9, [_cache[17] || (_cache[17] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"产品描述\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $setup.form.description = $event),\n    class: _normalizeClass([\"form-textarea\", {\n      'error': $setup.errors.description\n    }]),\n    placeholder: \"请详细描述您的产品特点、种植方式等\",\n    rows: \"4\",\n    maxlength: \"500\"\n  }, null, 2 /* CLASS */), [[_vModelText, $setup.form.description]]), $setup.errors.description ? (_openBlock(), _createElementBlock(\"span\", _hoisted_10, _toDisplayString($setup.errors.description), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])]), _createCommentVNode(\" 价格和库存 \"), _createElementVNode(\"div\", _hoisted_11, [_cache[21] || (_cache[21] = _createElementVNode(\"h3\", {\n    class: \"section-title\"\n  }, \"价格和库存\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"div\", _hoisted_13, [_cache[19] || (_cache[19] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"价格 (元/斤)\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $setup.form.price = $event),\n    type: \"number\",\n    class: _normalizeClass([\"form-input\", {\n      'error': $setup.errors.price\n    }]),\n    placeholder: \"0.00\",\n    step: \"0.01\",\n    min: \"0\"\n  }, null, 2 /* CLASS */), [[_vModelText, $setup.form.price]]), $setup.errors.price ? (_openBlock(), _createElementBlock(\"span\", _hoisted_14, _toDisplayString($setup.errors.price), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_15, [_cache[20] || (_cache[20] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"库存数量(斤)\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $setup.form.stock = $event),\n    type: \"number\",\n    class: _normalizeClass([\"form-input\", {\n      'error': $setup.errors.stock\n    }]),\n    placeholder: \"0\",\n    min: \"0\"\n  }, null, 2 /* CLASS */), [[_vModelText, $setup.form.stock]]), $setup.errors.stock ? (_openBlock(), _createElementBlock(\"span\", _hoisted_16, _toDisplayString($setup.errors.stock), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])])]), _createCommentVNode(\" 产品规格 \"), _createElementVNode(\"div\", _hoisted_17, [_cache[25] || (_cache[25] = _createElementVNode(\"h3\", {\n    class: \"section-title\"\n  }, \"产品规格\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_18, [_createElementVNode(\"div\", _hoisted_19, [_cache[22] || (_cache[22] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"产地\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[6] || (_cache[6] = $event => $setup.form.origin = $event),\n    type: \"text\",\n    class: _normalizeClass([\"form-input\", {\n      'error': $setup.errors.origin\n    }]),\n    placeholder: \"请输入产品产地\",\n    maxlength: \"50\"\n  }, null, 2 /* CLASS */), [[_vModelText, $setup.form.origin]]), $setup.errors.origin ? (_openBlock(), _createElementBlock(\"span\", _hoisted_20, _toDisplayString($setup.errors.origin), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_21, [_cache[23] || (_cache[23] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"保质期 (天)\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[7] || (_cache[7] = $event => $setup.form.shelf_life = $event),\n    type: \"number\",\n    class: _normalizeClass([\"form-input\", {\n      'error': $setup.errors.shelf_life\n    }]),\n    placeholder: \"0\",\n    min: \"0\"\n  }, null, 2 /* CLASS */), [[_vModelText, $setup.form.shelf_life]]), $setup.errors.shelf_life ? (_openBlock(), _createElementBlock(\"span\", _hoisted_22, _toDisplayString($setup.errors.shelf_life), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])]), _createElementVNode(\"div\", _hoisted_23, [_cache[24] || (_cache[24] = _createElementVNode(\"label\", {\n    class: \"form-label required\"\n  }, \"商品规格描述\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[8] || (_cache[8] = $event => $setup.form.specification = $event),\n    class: _normalizeClass([\"form-textarea\", {\n      'error': $setup.errors.specification\n    }]),\n    placeholder: \"请详细描述商品的规格、重量、尺寸等具体信息\",\n    rows: \"3\",\n    maxlength: \"200\"\n  }, null, 2 /* CLASS */), [[_vModelText, $setup.form.specification]]), $setup.errors.specification ? (_openBlock(), _createElementBlock(\"span\", _hoisted_24, _toDisplayString($setup.errors.specification), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])])]), _createElementVNode(\"div\", _hoisted_25, [_createElementVNode(\"button\", {\n    type: \"button\",\n    class: \"btn-cancel\",\n    onClick: _cache[9] || (_cache[9] = (...args) => $setup.handleClose && $setup.handleClose(...args))\n  }, \" 取消 \"), _createElementVNode(\"button\", {\n    type: \"submit\",\n    class: \"btn-submit\",\n    disabled: $setup.loading\n  }, _toDisplayString($setup.loading ? '保存中...' : $props.isEdit ? '更新' : '发布'), 9 /* TEXT, PROPS */, _hoisted_26)])], 32 /* NEED_HYDRATION */)])]);\n}","map":{"version":3,"names":["class","_createElementBlock","onClick","_cache","args","$setup","handleOverlayClick","_createElementVNode","_withModifiers","_hoisted_1","_hoisted_2","_toDisplayString","$props","isEdit","handleClose","onSubmit","handleSubmit","_hoisted_3","_createCommentVNode","_hoisted_4","_hoisted_5","form","title","$event","type","_normalizeClass","errors","placeholder","maxlength","_hoisted_6","_hoisted_7","category","value","_hoisted_8","_hoisted_9","description","rows","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","price","step","min","_hoisted_14","_hoisted_15","stock","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","origin","_hoisted_20","_hoisted_21","shelf_life","_hoisted_22","_hoisted_23","specification","_hoisted_24","_hoisted_25","disabled","loading","_hoisted_26"],"sources":["D:\\STUDY\\FarmerHappy\\farmer_happy\\src\\components\\ProductForm.vue"],"sourcesContent":["<template>\r\n  <div class=\"modal-overlay\" @click=\"handleOverlayClick\">\r\n    <div class=\"modal-container\" @click.stop>\r\n      <div class=\"modal-header\">\r\n        <h2 class=\"modal-title\">{{ isEdit ? '编辑农产品' : '发布农产品' }}</h2>\r\n        <button class=\"close-btn\" @click=\"handleClose\">\r\n          <span class=\"close-icon\">×</span>\r\n        </button>\r\n      </div>\r\n\r\n      <form @submit.prevent=\"handleSubmit\" class=\"modal-form\">\r\n        <div class=\"form-content\">\r\n          <!-- 基本信息 -->\r\n          <div class=\"form-section\">\r\n            <h3 class=\"section-title\">基本信息</h3>\r\n            \r\n            <div class=\"form-group\">\r\n              <label class=\"form-label required\">产品标题</label>\r\n              <input\r\n                v-model=\"form.title\"\r\n                type=\"text\"\r\n                class=\"form-input\"\r\n                :class=\"{ 'error': errors.title }\"\r\n                placeholder=\"请输入产品标题\"\r\n                maxlength=\"100\"\r\n              />\r\n              <span v-if=\"errors.title\" class=\"form-error\">{{ errors.title }}</span>\r\n            </div>\r\n\r\n             <div class=\"form-group\">\r\n               <label class=\"form-label required\">产品分类</label>\r\n               <select\r\n                 v-model=\"form.category\"\r\n                 class=\"form-input\"\r\n                 :class=\"{ 'error': errors.category }\"\r\n               >\r\n                 <option value=\"\">请选择产品分类</option>\r\n                 <option value=\"vegetables\">蔬菜</option>\r\n                 <option value=\"fruits\">水果</option>\r\n                 <option value=\"grains\">粮食</option>\r\n               </select>\r\n               <span v-if=\"errors.category\" class=\"form-error\">{{ errors.category }}</span>\r\n             </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label class=\"form-label\">产品描述</label>\r\n              <textarea\r\n                v-model=\"form.description\"\r\n                class=\"form-textarea\"\r\n                :class=\"{ 'error': errors.description }\"\r\n                placeholder=\"请详细描述您的产品特点、种植方式等\"\r\n                rows=\"4\"\r\n                maxlength=\"500\"\r\n              ></textarea>\r\n              <span v-if=\"errors.description\" class=\"form-error\">{{ errors.description }}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- 价格和库存 -->\r\n          <div class=\"form-section\">\r\n            <h3 class=\"section-title\">价格和库存</h3>\r\n            \r\n            <div class=\"form-row\">\r\n              <div class=\"form-group\">\r\n                <label class=\"form-label\">价格 (元/斤)</label>\r\n                <input\r\n                  v-model=\"form.price\"\r\n                  type=\"number\"\r\n                  class=\"form-input\"\r\n                  :class=\"{ 'error': errors.price }\"\r\n                  placeholder=\"0.00\"\r\n                  step=\"0.01\"\r\n                  min=\"0\"\r\n                />\r\n                <span v-if=\"errors.price\" class=\"form-error\">{{ errors.price }}</span>\r\n              </div>\r\n\r\n              <div class=\"form-group\">\r\n                <label class=\"form-label\">库存数量(斤)</label>\r\n                <input\r\n                  v-model=\"form.stock\"\r\n                  type=\"number\"\r\n                  class=\"form-input\"\r\n                  :class=\"{ 'error': errors.stock }\"\r\n                  placeholder=\"0\"\r\n                  min=\"0\"\r\n                />\r\n                <span v-if=\"errors.stock\" class=\"form-error\">{{ errors.stock }}</span>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n\r\n          <!-- 产品规格 -->\r\n          <div class=\"form-section\">\r\n            <h3 class=\"section-title\">产品规格</h3>\r\n            \r\n            <div class=\"form-row\">\r\n              <div class=\"form-group\">\r\n                <label class=\"form-label\">产地</label>\r\n                <input\r\n                  v-model=\"form.origin\"\r\n                  type=\"text\"\r\n                  class=\"form-input\"\r\n                  :class=\"{ 'error': errors.origin }\"\r\n                  placeholder=\"请输入产品产地\"\r\n                  maxlength=\"50\"\r\n                />\r\n                <span v-if=\"errors.origin\" class=\"form-error\">{{ errors.origin }}</span>\r\n              </div>\r\n\r\n              <div class=\"form-group\">\r\n                <label class=\"form-label\">保质期 (天)</label>\r\n                <input\r\n                  v-model=\"form.shelf_life\"\r\n                  type=\"number\"\r\n                  class=\"form-input\"\r\n                  :class=\"{ 'error': errors.shelf_life }\"\r\n                  placeholder=\"0\"\r\n                  min=\"0\"\r\n                />\r\n                <span v-if=\"errors.shelf_life\" class=\"form-error\">{{ errors.shelf_life }}</span>\r\n              </div>\r\n            </div>\r\n\r\n\r\n             <div class=\"form-group\">\r\n               <label class=\"form-label required\">商品规格描述</label>\r\n               <textarea\r\n                 v-model=\"form.specification\"\r\n                 class=\"form-textarea\"\r\n                 :class=\"{ 'error': errors.specification }\"\r\n                 placeholder=\"请详细描述商品的规格、重量、尺寸等具体信息\"\r\n                 rows=\"3\"\r\n                 maxlength=\"200\"\r\n               ></textarea>\r\n               <span v-if=\"errors.specification\" class=\"form-error\">{{ errors.specification }}</span>\r\n             </div>\r\n          </div>\r\n\r\n        </div>\r\n\r\n        <div class=\"modal-footer\">\r\n          <button type=\"button\" class=\"btn-cancel\" @click=\"handleClose\">\r\n            取消\r\n          </button>\r\n          <button type=\"submit\" class=\"btn-submit\" :disabled=\"loading\">\r\n            {{ loading ? '保存中...' : (isEdit ? '更新' : '发布') }}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, computed, watch, onMounted } from 'vue';\r\nimport { productService } from '../api/product';\r\nimport logger from '../utils/logger';\r\n\r\nexport default {\r\n  name: 'ProductForm',\r\n  props: {\r\n    product: {\r\n      type: Object,\r\n      default: null\r\n    },\r\n    isEdit: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  emits: ['close', 'success'],\r\n  setup(props, { emit }) {\r\n    const loading = ref(false);\r\n    const userInfo = ref({});\r\n\r\n     // 表单数据\r\n     const form = reactive({\r\n       title: '',\r\n       category: '',\r\n       description: '',\r\n       price: '',\r\n       stock: '',\r\n       origin: '',\r\n       shelf_life: '',\r\n       specification: ''\r\n     });\r\n\r\n     // 表单验证错误\r\n     const errors = reactive({\r\n       title: '',\r\n       category: '',\r\n       description: '',\r\n       price: '',\r\n       stock: '',\r\n       origin: '',\r\n       shelf_life: '',\r\n       specification: ''\r\n     });\r\n\r\n    // 获取用户信息\r\n    onMounted(() => {\r\n      const storedUser = localStorage.getItem('user');\r\n      if (storedUser) {\r\n        try {\r\n          userInfo.value = JSON.parse(storedUser);\r\n        } catch (error) {\r\n          logger.error('PRODUCT_FORM', '解析用户信息失败', {}, error);\r\n        }\r\n      }\r\n\r\n       // 如果是编辑模式，填充表单数据\r\n       if (props.isEdit && props.product) {\r\n         Object.assign(form, {\r\n           title: props.product.title || '',\r\n           category: props.product.category || '',\r\n           description: props.product.description || '',\r\n           price: props.product.price || '',\r\n           stock: props.product.stock || '',\r\n           origin: props.product.origin || '',\r\n           shelf_life: props.product.shelf_life || '',\r\n           specification: props.product.specification || ''\r\n         });\r\n       }\r\n    });\r\n\r\n    // 表单验证\r\n    const validateForm = () => {\r\n      logger.debug('PRODUCT_FORM', '开始验证表单');\r\n      let isValid = true;\r\n      \r\n      // 清空错误信息\r\n      Object.keys(errors).forEach(key => {\r\n        errors[key] = '';\r\n      });\r\n\r\n      // 验证必填字段\r\n      if (!form.title.trim()) {\r\n        errors.title = '请输入产品标题';\r\n        isValid = false;\r\n      } else if (form.title.length > 100) {\r\n        errors.title = '产品标题不能超过100个字符';\r\n        isValid = false;\r\n      }\r\n\r\n      if (!form.category) {\r\n        errors.category = '请选择产品分类';\r\n        isValid = false;\r\n      }\r\n\r\n      // 验证描述\r\n      if (form.description && form.description.length > 500) {\r\n        errors.description = '产品描述不能超过500个字符';\r\n        isValid = false;\r\n      }\r\n\r\n      // 验证价格\r\n      if (form.price && (isNaN(form.price) || form.price < 0)) {\r\n        errors.price = '请输入有效的价格';\r\n        isValid = false;\r\n      }\r\n\r\n      // 验证库存\r\n      if (form.stock && (isNaN(form.stock) || form.stock < 0)) {\r\n        errors.stock = '请输入有效的库存数量';\r\n        isValid = false;\r\n      }\r\n\r\n      // 验证保质期\r\n      if (form.shelf_life && (isNaN(form.shelf_life) || form.shelf_life < 0)) {\r\n        errors.shelf_life = '请输入有效的保质期';\r\n        isValid = false;\r\n      }\r\n\r\n       // 验证产地\r\n       if (form.origin && form.origin.length > 50) {\r\n         errors.origin = '产地不能超过50个字符';\r\n         isValid = false;\r\n       }\r\n\r\n       // 验证规格描述\r\n       if (!form.specification.trim()) {\r\n         errors.specification = '请输入商品规格描述';\r\n         isValid = false;\r\n       } else if (form.specification.length > 200) {\r\n         errors.specification = '规格描述不能超过200个字符';\r\n         isValid = false;\r\n       }\r\n\r\n       logger.validation('ProductForm', isValid, errors);\r\n       return isValid;\r\n    };\r\n\r\n    // 提交表单\r\n    const handleSubmit = async () => {\r\n      logger.userAction('PRODUCT_FORM_SUBMIT', { \r\n        isEdit: props.isEdit,\r\n        productId: props.product?.product_id \r\n      });\r\n\r\n      if (!validateForm()) {\r\n        logger.warn('PRODUCT_FORM', '表单验证失败');\r\n        return;\r\n      }\r\n\r\n      loading.value = true;\r\n      try {\r\n         // 准备提交数据\r\n         const submitData = {\r\n           title: form.title.trim(),\r\n           category: form.category,\r\n           description: form.description.trim(),\r\n           price: form.price ? parseFloat(form.price) : null,\r\n           stock: form.stock ? parseInt(form.stock) : null,\r\n           origin: form.origin.trim(),\r\n           shelf_life: form.shelf_life ? parseInt(form.shelf_life) : null,\r\n           specification: form.specification.trim()\r\n         };\r\n\r\n        logger.info('PRODUCT_FORM', '开始提交产品数据', { \r\n          isEdit: props.isEdit,\r\n          data: submitData \r\n        });\r\n\r\n        let response;\r\n        if (props.isEdit) {\r\n          response = await productService.updateProduct(props.product.product_id, submitData);\r\n        } else {\r\n          response = await productService.createProduct(submitData);\r\n        }\r\n\r\n        logger.info('PRODUCT_FORM', '产品操作成功', { \r\n          isEdit: props.isEdit,\r\n          productId: response.data?.product_id \r\n        });\r\n\r\n        emit('success');\r\n      } catch (error) {\r\n        logger.error('PRODUCT_FORM', '产品操作失败', {\r\n          isEdit: props.isEdit,\r\n          errorMessage: error.message || error\r\n        }, error);\r\n\r\n        // 处理验证错误\r\n        if (error.errors && Array.isArray(error.errors)) {\r\n          error.errors.forEach(err => {\r\n            if (err.field && Object.prototype.hasOwnProperty.call(errors, err.field)) {\r\n              errors[err.field] = err.message;\r\n            }\r\n          });\r\n        } else {\r\n          alert('操作失败：' + (error.message || error));\r\n        }\r\n      } finally {\r\n        loading.value = false;\r\n      }\r\n    };\r\n\r\n    // 关闭弹窗\r\n    const handleClose = () => {\r\n      logger.userAction('PRODUCT_FORM_CLOSE', { isEdit: props.isEdit });\r\n      emit('close');\r\n    };\r\n\r\n    // 点击遮罩层关闭\r\n    const handleOverlayClick = (event) => {\r\n      if (event.target === event.currentTarget) {\r\n        handleClose();\r\n      }\r\n    };\r\n\r\n    return {\r\n      loading,\r\n      form,\r\n      errors,\r\n      handleSubmit,\r\n      handleClose,\r\n      handleOverlayClick\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n@import '../assets/styles/theme.css';\r\n\r\n.modal-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n  padding: 1rem;\r\n}\r\n\r\n.modal-container {\r\n  background: var(--white);\r\n  border-radius: 16px;\r\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\r\n  width: 100%;\r\n  max-width: 800px;\r\n  max-height: 90vh;\r\n  overflow: hidden;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.modal-header {\r\n  padding: 1.5rem 2rem;\r\n  border-bottom: 1px solid var(--gray-200);\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.modal-title {\r\n  font-size: 1.25rem;\r\n  font-weight: 600;\r\n  color: var(--primary);\r\n  margin: 0;\r\n}\r\n\r\n.close-btn {\r\n  width: 32px;\r\n  height: 32px;\r\n  border: none;\r\n  background: transparent;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  cursor: pointer;\r\n  transition: background 0.2s;\r\n}\r\n\r\n.close-btn:hover {\r\n  background: var(--gray-100);\r\n}\r\n\r\n.close-icon {\r\n  font-size: 1.5rem;\r\n  color: var(--gray-500);\r\n}\r\n\r\n.modal-form {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  overflow: hidden;\r\n}\r\n\r\n.form-content {\r\n  flex: 1;\r\n  overflow-y: auto;\r\n  padding: 2rem;\r\n}\r\n\r\n.form-section {\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.section-title {\r\n  font-size: 1rem;\r\n  font-weight: 600;\r\n  color: #1a202c;\r\n  margin: 0 0 1rem 0;\r\n  padding-bottom: 0.5rem;\r\n  border-bottom: 2px solid var(--primary-light);\r\n}\r\n\r\n.form-group {\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.form-row {\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 1rem;\r\n}\r\n\r\n.form-label {\r\n  display: block;\r\n  margin-bottom: 0.5rem;\r\n  color: var(--gray-600);\r\n  font-size: 0.875rem;\r\n  font-weight: 500;\r\n}\r\n\r\n.form-label.required::after {\r\n  content: ' *';\r\n  color: var(--error);\r\n}\r\n\r\n.form-input, .form-textarea {\r\n  width: 100%;\r\n  padding: 0.75rem;\r\n  border: 1px solid var(--gray-300);\r\n  border-radius: 8px;\r\n  font-size: 0.875rem;\r\n  transition: all 0.2s;\r\n  background: var(--white);\r\n}\r\n\r\n.form-input:focus, .form-textarea:focus {\r\n  outline: none;\r\n  border-color: var(--primary);\r\n  box-shadow: 0 0 0 3px rgba(107, 70, 193, 0.1);\r\n}\r\n\r\n.form-input.error, .form-textarea.error {\r\n  border-color: var(--error);\r\n}\r\n\r\n.form-textarea {\r\n  resize: vertical;\r\n  min-height: 100px;\r\n}\r\n\r\n .form-error {\r\n   display: block;\r\n   color: var(--error);\r\n   font-size: 0.75rem;\r\n   margin-top: 0.25rem;\r\n }\r\n\r\n .unit-display {\r\n   display: flex;\r\n   align-items: center;\r\n   gap: 0.5rem;\r\n   padding: 0.75rem;\r\n   background: var(--gray-100);\r\n   border-radius: 8px;\r\n   border: 1px solid var(--gray-300);\r\n }\r\n\r\n .unit-text {\r\n   font-size: 0.875rem;\r\n   font-weight: 500;\r\n   color: #1a202c;\r\n }\r\n\r\n .unit-note {\r\n   font-size: 0.75rem;\r\n   color: var(--gray-500);\r\n }\r\n\r\n.radio-group {\r\n  display: flex;\r\n  gap: 1rem;\r\n}\r\n\r\n.radio-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  cursor: pointer;\r\n}\r\n\r\n.radio-input {\r\n  accent-color: var(--primary);\r\n}\r\n\r\n.radio-label {\r\n  font-size: 0.875rem;\r\n  color: var(--gray-600);\r\n}\r\n\r\n.modal-footer {\r\n  padding: 1.5rem 2rem;\r\n  border-top: 1px solid var(--gray-200);\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 1rem;\r\n}\r\n\r\n.btn-cancel, .btn-submit {\r\n  padding: 0.75rem 1.5rem;\r\n  border: none;\r\n  border-radius: 8px;\r\n  font-size: 0.875rem;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.btn-cancel {\r\n  background: var(--gray-200);\r\n  color: var(--gray-600);\r\n}\r\n\r\n.btn-cancel:hover {\r\n  background: var(--gray-300);\r\n}\r\n\r\n.btn-submit {\r\n  background: var(--primary);\r\n  color: var(--white);\r\n}\r\n\r\n.btn-submit:hover:not(:disabled) {\r\n  background: var(--primary-dark);\r\n}\r\n\r\n.btn-submit:disabled {\r\n  opacity: 0.6;\r\n  cursor: not-allowed;\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 768px) {\r\n  .modal-overlay {\r\n    padding: 0.5rem;\r\n  }\r\n\r\n  .modal-container {\r\n    max-height: 95vh;\r\n  }\r\n\r\n  .modal-header {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .form-content {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .form-row {\r\n    grid-template-columns: 1fr;\r\n  }\r\n\r\n  .modal-footer {\r\n    padding: 1rem;\r\n    flex-direction: column;\r\n  }\r\n\r\n  .btn-cancel, .btn-submit {\r\n    width: 100%;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}