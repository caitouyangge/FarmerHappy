{"ast":null,"code":"import { ref, computed, onMounted, watch } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { orderService } from '../api/order';\nimport logger from '../utils/logger';\nexport default {\n  name: 'OrderDetail',\n  setup() {\n    const route = useRoute();\n    const router = useRouter();\n    const orderId = computed(() => {\n      const id = route.params.id;\n      // 确保返回字符串类型，避免 undefined\n      return id ? String(id) : null;\n    });\n    const orderDetail = ref(null);\n    const loading = ref(false);\n    const error = ref('');\n    const showImagePreview = ref(false);\n    const previewImage = ref('');\n    const showRefundDialog = ref(false);\n    const refundForm = ref({\n      refundType: '',\n      refundReason: ''\n    });\n\n    // 获取用户信息\n    const userInfo = ref({});\n    const userPhone = computed(() => {\n      return userInfo.value.phone || '';\n    });\n    const isBuyer = computed(() => {\n      return userInfo.value.userType === 'buyer';\n    });\n    const isFarmer = computed(() => {\n      return userInfo.value.userType === 'farmer';\n    });\n\n    // 加载用户信息\n    const loadUserInfo = () => {\n      const storedUser = localStorage.getItem('user');\n      if (storedUser) {\n        try {\n          userInfo.value = JSON.parse(storedUser);\n        } catch (err) {\n          logger.error('ORDER_DETAIL', '解析用户信息失败', {}, err);\n        }\n      }\n    };\n\n    // 加载订单详情\n    const loadOrderDetail = async () => {\n      if (!userPhone.value) {\n        error.value = '请先登录';\n        return;\n      }\n\n      // 获取当前路由参数，确保获取到最新的值\n      const currentOrderId = route.params.id || orderId.value;\n      if (!currentOrderId) {\n        error.value = '订单ID不存在，请从订单列表进入';\n        logger.error('ORDER_DETAIL', '订单ID不存在', {\n          routeParams: route.params,\n          orderIdValue: orderId.value\n        });\n        return;\n      }\n      loading.value = true;\n      error.value = '';\n      try {\n        logger.info('ORDER_DETAIL', '开始加载订单详情', {\n          orderId: currentOrderId,\n          userType: userInfo.value.userType,\n          phone: userPhone.value,\n          routeParams: route.params\n        });\n        let data;\n        if (isBuyer.value) {\n          // 买家查询订单详情\n          data = await orderService.getOrderDetail(currentOrderId, {\n            buyer_phone: userPhone.value\n          });\n        } else if (isFarmer.value) {\n          // 农户查询订单详情\n          data = await orderService.getFarmerOrderDetail(currentOrderId, {\n            farmer_phone: userPhone.value\n          });\n        } else {\n          error.value = '当前用户类型不支持查看订单详情';\n          return;\n        }\n        orderDetail.value = data;\n        logger.info('ORDER_DETAIL', '订单详情加载成功', {\n          orderId: orderId.value,\n          status: data.status\n        });\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '加载订单详情失败', {\n          orderId: orderId.value,\n          errorMessage: err.message || err\n        }, err);\n        error.value = err.message || '加载订单详情失败，请稍后重试';\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 格式化日期时间\n    const formatDateTime = dateString => {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      const hours = String(date.getHours()).padStart(2, '0');\n      const minutes = String(date.getMinutes()).padStart(2, '0');\n      const seconds = String(date.getSeconds()).padStart(2, '0');\n      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n    };\n\n    // 格式化价格\n    const formatPrice = price => {\n      if (!price) return '0.00';\n      return parseFloat(price).toFixed(2);\n    };\n\n    // 获取状态文本\n    const getStatusText = status => {\n      const statusMap = {\n        shipped: '已发货',\n        completed: '已完成',\n        cancelled: '已取消',\n        refunded: '已退款'\n      };\n      return statusMap[status] || status;\n    };\n\n    // 返回\n    const handleBack = () => {\n      router.push('/orders');\n    };\n\n    // 点击图片预览\n    const handleImageClick = image => {\n      previewImage.value = image;\n      showImagePreview.value = true;\n    };\n\n    // 确认收货\n    const handleConfirmReceipt = async () => {\n      if (!confirm('确认收到商品吗？')) {\n        return;\n      }\n      try {\n        logger.userAction('ORDER_CONFIRM_RECEIPT', {\n          orderId: orderId.value\n        });\n        await orderService.confirmReceipt(orderId.value, {\n          buyer_phone: userPhone.value\n        });\n        alert('确认收货成功！');\n        loadOrderDetail();\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '确认收货失败', {\n          orderId: orderId.value,\n          errorMessage: err.message || err\n        }, err);\n        alert(err.message || '确认收货失败，请稍后重试');\n      }\n    };\n\n    // 申请退款\n    const handleApplyRefund = () => {\n      refundForm.value = {\n        refundType: '',\n        refundReason: ''\n      };\n      showRefundDialog.value = true;\n    };\n\n    // 提交退款申请\n    const handleSubmitRefund = async () => {\n      if (!refundForm.value.refundType) {\n        alert('请选择退款类型');\n        return;\n      }\n      if (!refundForm.value.refundReason.trim()) {\n        alert('请输入退款原因');\n        return;\n      }\n      try {\n        logger.userAction('ORDER_APPLY_REFUND', {\n          orderId: orderId.value,\n          refundType: refundForm.value.refundType\n        });\n        await orderService.applyRefund(orderId.value, {\n          buyer_phone: userPhone.value,\n          refund_type: refundForm.value.refundType,\n          refund_reason: refundForm.value.refundReason.trim()\n        });\n        alert('退款申请提交成功！');\n        showRefundDialog.value = false;\n        loadOrderDetail();\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '申请退款失败', {\n          orderId: orderId.value,\n          errorMessage: err.message || err,\n          errors: err.errors || []\n        }, err);\n        if (err.errors && Array.isArray(err.errors) && err.errors.length > 0) {\n          const errorMessages = err.errors.map(e => e.message).join('\\n');\n          alert(errorMessages || '申请退款失败，请稍后重试');\n        } else {\n          alert(err.message || '申请退款失败，请稍后重试');\n        }\n      }\n    };\n\n    // 取消订单\n    const handleCancelOrder = async () => {\n      const reason = prompt('请输入取消原因（选填）：');\n      if (reason === null) {\n        return;\n      }\n      try {\n        logger.userAction('ORDER_CANCEL', {\n          orderId: orderId.value\n        });\n        await orderService.cancelOrder(orderId.value, {\n          buyer_phone: userPhone.value,\n          cancel_reason: reason || undefined\n        });\n        alert('订单取消成功！');\n        loadOrderDetail();\n      } catch (err) {\n        logger.error('ORDER_DETAIL', '取消订单失败', {\n          orderId: orderId.value,\n          errorMessage: err.message || err\n        }, err);\n        alert(err.message || '取消订单失败，请稍后重试');\n      }\n    };\n\n    // 监听路由参数变化\n    watch(() => route.params.id, newId => {\n      if (newId) {\n        loadOrderDetail();\n      }\n    }, {\n      immediate: false\n    });\n\n    // 初始化\n    onMounted(() => {\n      loadUserInfo();\n      // 确保路由参数已加载\n      if (orderId.value) {\n        loadOrderDetail();\n      } else {\n        // 如果路由参数未加载，等待一下再试\n        setTimeout(() => {\n          if (orderId.value) {\n            loadOrderDetail();\n          } else {\n            error.value = '订单ID不存在，请从订单列表进入';\n          }\n        }, 100);\n      }\n    });\n    return {\n      orderId,\n      orderDetail,\n      loading,\n      error,\n      isBuyer,\n      isFarmer,\n      showImagePreview,\n      previewImage,\n      showRefundDialog,\n      refundForm,\n      formatDateTime,\n      formatPrice,\n      getStatusText,\n      handleBack,\n      handleImageClick,\n      handleConfirmReceipt,\n      handleApplyRefund,\n      handleSubmitRefund,\n      handleCancelOrder,\n      loadOrderDetail\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","useRoute","useRouter","orderService","logger","name","setup","route","router","orderId","id","params","String","orderDetail","loading","error","showImagePreview","previewImage","showRefundDialog","refundForm","refundType","refundReason","userInfo","userPhone","value","phone","isBuyer","userType","isFarmer","loadUserInfo","storedUser","localStorage","getItem","JSON","parse","err","loadOrderDetail","currentOrderId","routeParams","orderIdValue","info","data","getOrderDetail","buyer_phone","getFarmerOrderDetail","farmer_phone","status","errorMessage","message","formatDateTime","dateString","date","Date","year","getFullYear","month","getMonth","padStart","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","formatPrice","price","parseFloat","toFixed","getStatusText","statusMap","shipped","completed","cancelled","refunded","handleBack","push","handleImageClick","image","handleConfirmReceipt","confirm","userAction","confirmReceipt","alert","handleApplyRefund","handleSubmitRefund","trim","applyRefund","refund_type","refund_reason","errors","Array","isArray","length","errorMessages","map","e","join","handleCancelOrder","reason","prompt","cancelOrder","cancel_reason","undefined","newId","immediate","setTimeout"],"sources":["D:\\STUDY\\FarmerHappy\\farmer_happy\\src\\orders\\OrderDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"order-detail-container\">\r\n    <!-- 顶部导航栏 -->\r\n    <header class=\"header\">\r\n      <div class=\"header-left\">\r\n        <button class=\"btn-back\" @click=\"handleBack\">\r\n          <span class=\"back-icon\">←</span>\r\n          返回\r\n        </button>\r\n        <h1 class=\"page-title\">订单详情</h1>\r\n      </div>\r\n    </header>\r\n\r\n    <!-- 主内容区域 -->\r\n    <main class=\"main-content\">\r\n      <div class=\"content-wrapper\">\r\n        <!-- 加载状态 -->\r\n        <div v-if=\"loading\" class=\"loading-container\">\r\n          <div class=\"loading-spinner\"></div>\r\n          <p>加载中...</p>\r\n        </div>\r\n\r\n        <!-- 错误提示 -->\r\n        <div v-else-if=\"error\" class=\"error-container\">\r\n          <div class=\"error-message\">\r\n            <span class=\"error-icon\">⚠️</span>\r\n            <span class=\"error-text\">{{ error }}</span>\r\n          </div>\r\n          <button class=\"btn-retry\" @click=\"loadOrderDetail\">重试</button>\r\n        </div>\r\n\r\n        <!-- 订单详情 -->\r\n        <div v-else-if=\"orderDetail\" class=\"order-detail\">\r\n          <!-- 订单状态卡片 -->\r\n          <div class=\"status-card\">\r\n            <div class=\"status-header\">\r\n              <span class=\"status-label\">订单状态</span>\r\n              <span :class=\"['status-badge', `status-${orderDetail.status}`]\">\r\n                {{ getStatusText(orderDetail.status) }}\r\n              </span>\r\n            </div>\r\n            <div class=\"status-info\">\r\n              <p class=\"order-id-text\">订单号：{{ orderDetail.orderId }}</p>\r\n              <p class=\"create-time\">创建时间：{{ formatDateTime(orderDetail.createdAt) }}</p>\r\n              <p v-if=\"orderDetail.shippedAt\" class=\"time-info\">\r\n                发货时间：{{ formatDateTime(orderDetail.shippedAt) }}\r\n              </p>\r\n              <p v-if=\"orderDetail.completedAt\" class=\"time-info\">\r\n                完成时间：{{ formatDateTime(orderDetail.completedAt) }}\r\n              </p>\r\n              <p v-if=\"orderDetail.cancelledAt\" class=\"time-info\">\r\n                取消时间：{{ formatDateTime(orderDetail.cancelledAt) }}\r\n              </p>\r\n              <p v-if=\"orderDetail.refundedAt\" class=\"time-info\">\r\n                退款时间：{{ formatDateTime(orderDetail.refundedAt) }}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- 商品信息 -->\r\n          <div class=\"section-card\">\r\n            <h2 class=\"section-title\">商品信息</h2>\r\n            <div class=\"product-info\">\r\n              <div v-if=\"orderDetail.images && orderDetail.images.length > 0\" class=\"product-images\">\r\n                <img\r\n                  v-for=\"(image, index) in orderDetail.images\"\r\n                  :key=\"index\"\r\n                  :src=\"image\"\r\n                  :alt=\"orderDetail.title\"\r\n                  class=\"product-image\"\r\n                  @click=\"handleImageClick(image)\"\r\n                />\r\n              </div>\r\n              <div class=\"product-details\">\r\n                <h3 class=\"product-title\">{{ orderDetail.title }}</h3>\r\n                <div v-if=\"orderDetail.specification\" class=\"product-spec\">\r\n                  规格：{{ orderDetail.specification }}\r\n                </div>\r\n                <div class=\"product-price-info\">\r\n                  <div class=\"price-row\">\r\n                    <span class=\"price-label\">单价：</span>\r\n                    <span class=\"price-value\">¥{{ formatPrice(orderDetail.price) }}</span>\r\n                  </div>\r\n                  <div class=\"price-row\">\r\n                    <span class=\"price-label\">数量：</span>\r\n                    <span class=\"price-value\">{{ orderDetail.quantity }} 斤</span>\r\n                  </div>\r\n                  <div class=\"price-row total\">\r\n                    <span class=\"price-label\">订单总额：</span>\r\n                    <span class=\"price-value total-price\">¥{{ formatPrice(orderDetail.totalAmount) }}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- 收货信息 -->\r\n          <div class=\"section-card\">\r\n            <h2 class=\"section-title\">收货信息</h2>\r\n            <div class=\"delivery-info\">\r\n              <div class=\"info-row\">\r\n                <span class=\"info-label\">收货人：</span>\r\n                <span class=\"info-value\">{{ orderDetail.buyerName }}</span>\r\n              </div>\r\n              <div class=\"info-row\">\r\n                <span class=\"info-label\">手机号：</span>\r\n                <span class=\"info-value\">{{ orderDetail.buyerPhone }}</span>\r\n              </div>\r\n              <div class=\"info-row\">\r\n                <span class=\"info-label\">收货地址：</span>\r\n                <span class=\"info-value\">{{ orderDetail.buyerAddress }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- 订单备注 -->\r\n          <div v-if=\"orderDetail.remark\" class=\"section-card\">\r\n            <h2 class=\"section-title\">订单备注</h2>\r\n            <p class=\"remark-text\">{{ orderDetail.remark }}</p>\r\n          </div>\r\n\r\n          <!-- 操作按钮 -->\r\n          <div v-if=\"isBuyer\" class=\"action-section\">\r\n            <button\r\n              v-if=\"orderDetail.status === 'shipped'\"\r\n              class=\"btn-action btn-primary\"\r\n              @click=\"handleConfirmReceipt\"\r\n            >\r\n              确认收货\r\n            </button>\r\n            <button\r\n              v-if=\"orderDetail.status === 'shipped'\"\r\n              class=\"btn-action btn-secondary\"\r\n              @click=\"handleApplyRefund\"\r\n            >\r\n              申请退款\r\n            </button>\r\n            <button\r\n              v-if=\"orderDetail.status === 'shipped'\"\r\n              class=\"btn-action btn-cancel\"\r\n              @click=\"handleCancelOrder\"\r\n            >\r\n              取消订单\r\n            </button>\r\n            <button\r\n              class=\"btn-action btn-default\"\r\n              @click=\"handleBack\"\r\n            >\r\n              返回订单列表\r\n            </button>\r\n          </div>\r\n          <div v-else class=\"action-section\">\r\n            <button\r\n              class=\"btn-action btn-default\"\r\n              @click=\"handleBack\"\r\n            >\r\n              返回订单列表\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </main>\r\n\r\n    <!-- 图片预览模态框 -->\r\n    <div v-if=\"showImagePreview\" class=\"image-modal\" @click=\"showImagePreview = false\">\r\n      <img :src=\"previewImage\" alt=\"预览\" class=\"preview-image\" @click.stop />\r\n      <button class=\"close-preview\" @click=\"showImagePreview = false\">×</button>\r\n    </div>\r\n\r\n    <!-- 退款对话框 -->\r\n    <div v-if=\"showRefundDialog\" class=\"dialog-overlay\" @click=\"showRefundDialog = false\">\r\n      <div class=\"dialog-content\" @click.stop>\r\n        <h3 class=\"dialog-title\">申请退款</h3>\r\n        <div class=\"dialog-body\">\r\n          <div class=\"form-group\">\r\n            <label class=\"form-label\">退款类型</label>\r\n            <select v-model=\"refundForm.refundType\" class=\"form-input\">\r\n              <option value=\"\">请选择退款类型</option>\r\n              <option value=\"refund\">仅退款</option>\r\n              <option value=\"refund_return\">退货退款</option>\r\n            </select>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-label\">退款原因 <span class=\"required\">*</span></label>\r\n            <textarea\r\n              v-model=\"refundForm.refundReason\"\r\n              class=\"form-textarea\"\r\n              placeholder=\"请输入退款原因\"\r\n              rows=\"4\"\r\n            ></textarea>\r\n          </div>\r\n        </div>\r\n        <div class=\"dialog-footer\">\r\n          <button class=\"btn-dialog btn-cancel\" @click=\"showRefundDialog = false\">取消</button>\r\n          <button class=\"btn-dialog btn-confirm\" @click=\"handleSubmitRefund\">提交</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, computed, onMounted, watch } from 'vue';\r\nimport { useRoute, useRouter } from 'vue-router';\r\nimport { orderService } from '../api/order';\r\nimport logger from '../utils/logger';\r\n\r\nexport default {\r\n  name: 'OrderDetail',\r\n  setup() {\r\n    const route = useRoute();\r\n    const router = useRouter();\r\n    const orderId = computed(() => {\r\n      const id = route.params.id;\r\n      // 确保返回字符串类型，避免 undefined\r\n      return id ? String(id) : null;\r\n    });\r\n    const orderDetail = ref(null);\r\n    const loading = ref(false);\r\n    const error = ref('');\r\n    const showImagePreview = ref(false);\r\n    const previewImage = ref('');\r\n    const showRefundDialog = ref(false);\r\n    const refundForm = ref({\r\n      refundType: '',\r\n      refundReason: ''\r\n    });\r\n\r\n    // 获取用户信息\r\n    const userInfo = ref({});\r\n    const userPhone = computed(() => {\r\n      return userInfo.value.phone || '';\r\n    });\r\n    const isBuyer = computed(() => {\r\n      return userInfo.value.userType === 'buyer';\r\n    });\r\n    const isFarmer = computed(() => {\r\n      return userInfo.value.userType === 'farmer';\r\n    });\r\n\r\n    // 加载用户信息\r\n    const loadUserInfo = () => {\r\n      const storedUser = localStorage.getItem('user');\r\n      if (storedUser) {\r\n        try {\r\n          userInfo.value = JSON.parse(storedUser);\r\n        } catch (err) {\r\n          logger.error('ORDER_DETAIL', '解析用户信息失败', {}, err);\r\n        }\r\n      }\r\n    };\r\n\r\n    // 加载订单详情\r\n    const loadOrderDetail = async () => {\r\n      if (!userPhone.value) {\r\n        error.value = '请先登录';\r\n        return;\r\n      }\r\n\r\n      // 获取当前路由参数，确保获取到最新的值\r\n      const currentOrderId = route.params.id || orderId.value;\r\n      if (!currentOrderId) {\r\n        error.value = '订单ID不存在，请从订单列表进入';\r\n        logger.error('ORDER_DETAIL', '订单ID不存在', {\r\n          routeParams: route.params,\r\n          orderIdValue: orderId.value\r\n        });\r\n        return;\r\n      }\r\n\r\n      loading.value = true;\r\n      error.value = '';\r\n\r\n      try {\r\n        logger.info('ORDER_DETAIL', '开始加载订单详情', {\r\n          orderId: currentOrderId,\r\n          userType: userInfo.value.userType,\r\n          phone: userPhone.value,\r\n          routeParams: route.params\r\n        });\r\n\r\n        let data;\r\n\r\n        if (isBuyer.value) {\r\n          // 买家查询订单详情\r\n          data = await orderService.getOrderDetail(currentOrderId, {\r\n            buyer_phone: userPhone.value\r\n          });\r\n        } else if (isFarmer.value) {\r\n          // 农户查询订单详情\r\n          data = await orderService.getFarmerOrderDetail(currentOrderId, {\r\n            farmer_phone: userPhone.value\r\n          });\r\n        } else {\r\n          error.value = '当前用户类型不支持查看订单详情';\r\n          return;\r\n        }\r\n\r\n        orderDetail.value = data;\r\n\r\n        logger.info('ORDER_DETAIL', '订单详情加载成功', {\r\n          orderId: orderId.value,\r\n          status: data.status\r\n        });\r\n      } catch (err) {\r\n        logger.error('ORDER_DETAIL', '加载订单详情失败', {\r\n          orderId: orderId.value,\r\n          errorMessage: err.message || err\r\n        }, err);\r\n        error.value = err.message || '加载订单详情失败，请稍后重试';\r\n      } finally {\r\n        loading.value = false;\r\n      }\r\n    };\r\n\r\n    // 格式化日期时间\r\n    const formatDateTime = (dateString) => {\r\n      if (!dateString) return '';\r\n      const date = new Date(dateString);\r\n      const year = date.getFullYear();\r\n      const month = String(date.getMonth() + 1).padStart(2, '0');\r\n      const day = String(date.getDate()).padStart(2, '0');\r\n      const hours = String(date.getHours()).padStart(2, '0');\r\n      const minutes = String(date.getMinutes()).padStart(2, '0');\r\n      const seconds = String(date.getSeconds()).padStart(2, '0');\r\n      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\r\n    };\r\n\r\n    // 格式化价格\r\n    const formatPrice = (price) => {\r\n      if (!price) return '0.00';\r\n      return parseFloat(price).toFixed(2);\r\n    };\r\n\r\n    // 获取状态文本\r\n    const getStatusText = (status) => {\r\n      const statusMap = {\r\n        shipped: '已发货',\r\n        completed: '已完成',\r\n        cancelled: '已取消',\r\n        refunded: '已退款'\r\n      };\r\n      return statusMap[status] || status;\r\n    };\r\n\r\n    // 返回\r\n    const handleBack = () => {\r\n      router.push('/orders');\r\n    };\r\n\r\n    // 点击图片预览\r\n    const handleImageClick = (image) => {\r\n      previewImage.value = image;\r\n      showImagePreview.value = true;\r\n    };\r\n\r\n    // 确认收货\r\n    const handleConfirmReceipt = async () => {\r\n      if (!confirm('确认收到商品吗？')) {\r\n        return;\r\n      }\r\n\r\n      try {\r\n        logger.userAction('ORDER_CONFIRM_RECEIPT', { orderId: orderId.value });\r\n        await orderService.confirmReceipt(orderId.value, {\r\n          buyer_phone: userPhone.value\r\n        });\r\n        alert('确认收货成功！');\r\n        loadOrderDetail();\r\n      } catch (err) {\r\n        logger.error('ORDER_DETAIL', '确认收货失败', {\r\n          orderId: orderId.value,\r\n          errorMessage: err.message || err\r\n        }, err);\r\n        alert(err.message || '确认收货失败，请稍后重试');\r\n      }\r\n    };\r\n\r\n    // 申请退款\r\n    const handleApplyRefund = () => {\r\n      refundForm.value = {\r\n        refundType: '',\r\n        refundReason: ''\r\n      };\r\n      showRefundDialog.value = true;\r\n    };\r\n\r\n    // 提交退款申请\r\n    const handleSubmitRefund = async () => {\r\n      if (!refundForm.value.refundType) {\r\n        alert('请选择退款类型');\r\n        return;\r\n      }\r\n\r\n      if (!refundForm.value.refundReason.trim()) {\r\n        alert('请输入退款原因');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        logger.userAction('ORDER_APPLY_REFUND', {\r\n          orderId: orderId.value,\r\n          refundType: refundForm.value.refundType\r\n        });\r\n\r\n        await orderService.applyRefund(orderId.value, {\r\n          buyer_phone: userPhone.value,\r\n          refund_type: refundForm.value.refundType,\r\n          refund_reason: refundForm.value.refundReason.trim()\r\n        });\r\n\r\n        alert('退款申请提交成功！');\r\n        showRefundDialog.value = false;\r\n        loadOrderDetail();\r\n      } catch (err) {\r\n        logger.error('ORDER_DETAIL', '申请退款失败', {\r\n          orderId: orderId.value,\r\n          errorMessage: err.message || err,\r\n          errors: err.errors || []\r\n        }, err);\r\n\r\n        if (err.errors && Array.isArray(err.errors) && err.errors.length > 0) {\r\n          const errorMessages = err.errors.map(e => e.message).join('\\n');\r\n          alert(errorMessages || '申请退款失败，请稍后重试');\r\n        } else {\r\n          alert(err.message || '申请退款失败，请稍后重试');\r\n        }\r\n      }\r\n    };\r\n\r\n    // 取消订单\r\n    const handleCancelOrder = async () => {\r\n      const reason = prompt('请输入取消原因（选填）：');\r\n      if (reason === null) {\r\n        return;\r\n      }\r\n\r\n      try {\r\n        logger.userAction('ORDER_CANCEL', { orderId: orderId.value });\r\n        await orderService.cancelOrder(orderId.value, {\r\n          buyer_phone: userPhone.value,\r\n          cancel_reason: reason || undefined\r\n        });\r\n        alert('订单取消成功！');\r\n        loadOrderDetail();\r\n      } catch (err) {\r\n        logger.error('ORDER_DETAIL', '取消订单失败', {\r\n          orderId: orderId.value,\r\n          errorMessage: err.message || err\r\n        }, err);\r\n        alert(err.message || '取消订单失败，请稍后重试');\r\n      }\r\n    };\r\n\r\n    // 监听路由参数变化\r\n    watch(() => route.params.id, (newId) => {\r\n      if (newId) {\r\n        loadOrderDetail();\r\n      }\r\n    }, { immediate: false });\r\n\r\n    // 初始化\r\n    onMounted(() => {\r\n      loadUserInfo();\r\n      // 确保路由参数已加载\r\n      if (orderId.value) {\r\n        loadOrderDetail();\r\n      } else {\r\n        // 如果路由参数未加载，等待一下再试\r\n        setTimeout(() => {\r\n          if (orderId.value) {\r\n            loadOrderDetail();\r\n          } else {\r\n            error.value = '订单ID不存在，请从订单列表进入';\r\n          }\r\n        }, 100);\r\n      }\r\n    });\r\n\r\n    return {\r\n      orderId,\r\n      orderDetail,\r\n      loading,\r\n      error,\r\n      isBuyer,\r\n      isFarmer,\r\n      showImagePreview,\r\n      previewImage,\r\n      showRefundDialog,\r\n      refundForm,\r\n      formatDateTime,\r\n      formatPrice,\r\n      getStatusText,\r\n      handleBack,\r\n      handleImageClick,\r\n      handleConfirmReceipt,\r\n      handleApplyRefund,\r\n      handleSubmitRefund,\r\n      handleCancelOrder,\r\n      loadOrderDetail\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n@import '../assets/styles/theme.css';\r\n\r\n.order-detail-container {\r\n  min-height: 100vh;\r\n  background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);\r\n}\r\n\r\n/* 顶部导航栏 */\r\n.header {\r\n  background: var(--white);\r\n  padding: 1rem 2rem;\r\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.1);\r\n  position: sticky;\r\n  top: 0;\r\n  z-index: 100;\r\n}\r\n\r\n.header-left {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 1rem;\r\n}\r\n\r\n.btn-back {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  padding: 0.5rem 1rem;\r\n  background: transparent;\r\n  border: 1px solid var(--gray-300);\r\n  border-radius: 8px;\r\n  color: var(--gray-600);\r\n  font-size: 0.875rem;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.btn-back:hover {\r\n  background: var(--gray-100);\r\n  border-color: var(--primary);\r\n  color: var(--primary);\r\n}\r\n\r\n.back-icon {\r\n  font-size: 1.125rem;\r\n}\r\n\r\n.page-title {\r\n  font-size: 1.5rem;\r\n  font-weight: 600;\r\n  color: var(--primary);\r\n  margin: 0;\r\n}\r\n\r\n/* 主内容区域 */\r\n.main-content {\r\n  padding: 2rem;\r\n}\r\n\r\n.content-wrapper {\r\n  max-width: 900px;\r\n  margin: 0 auto;\r\n}\r\n\r\n/* 加载状态 */\r\n.loading-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 4rem 2rem;\r\n  background: var(--white);\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\r\n}\r\n\r\n.loading-spinner {\r\n  width: 40px;\r\n  height: 40px;\r\n  border: 4px solid var(--gray-200);\r\n  border-top: 4px solid var(--primary);\r\n  border-radius: 50%;\r\n  animation: spin 1s linear infinite;\r\n  margin-bottom: 1rem;\r\n}\r\n\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n\r\n/* 错误提示 */\r\n.error-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 4rem 2rem;\r\n  background: var(--white);\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\r\n  gap: 1rem;\r\n}\r\n\r\n.error-message {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  color: var(--error);\r\n  font-size: 1rem;\r\n}\r\n\r\n.error-icon {\r\n  font-size: 1.25rem;\r\n}\r\n\r\n.btn-retry {\r\n  padding: 0.75rem 1.5rem;\r\n  background: var(--primary);\r\n  color: var(--white);\r\n  border: none;\r\n  border-radius: 8px;\r\n  font-size: 0.875rem;\r\n  cursor: pointer;\r\n  transition: background 0.2s;\r\n}\r\n\r\n.btn-retry:hover {\r\n  background: var(--primary-dark);\r\n}\r\n\r\n/* 订单详情 */\r\n.order-detail {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 1.5rem;\r\n}\r\n\r\n/* 状态卡片 */\r\n.status-card {\r\n  background: var(--white);\r\n  border-radius: 12px;\r\n  padding: 1.5rem;\r\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\r\n}\r\n\r\n.status-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 1rem;\r\n  padding-bottom: 1rem;\r\n  border-bottom: 1px solid var(--gray-200);\r\n}\r\n\r\n.status-label {\r\n  font-size: 1rem;\r\n  font-weight: 600;\r\n  color: #1a202c;\r\n}\r\n\r\n.status-badge {\r\n  padding: 0.5rem 1rem;\r\n  border-radius: 6px;\r\n  font-size: 0.875rem;\r\n  font-weight: 500;\r\n}\r\n\r\n.status-shipped {\r\n  background: #e0f2fe;\r\n  color: #0369a1;\r\n}\r\n\r\n.status-completed {\r\n  background: #dcfce7;\r\n  color: #166534;\r\n}\r\n\r\n.status-cancelled {\r\n  background: #fee2e2;\r\n  color: #991b1b;\r\n}\r\n\r\n.status-refunded {\r\n  background: #fef3c7;\r\n  color: #92400e;\r\n}\r\n\r\n.status-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.order-id-text {\r\n  font-size: 0.875rem;\r\n  color: #1a202c;\r\n  margin: 0;\r\n}\r\n\r\n.create-time,\r\n.time-info {\r\n  font-size: 0.875rem;\r\n  color: var(--gray-500);\r\n  margin: 0;\r\n}\r\n\r\n/* 通用卡片 */\r\n.section-card {\r\n  background: var(--white);\r\n  border-radius: 12px;\r\n  padding: 1.5rem;\r\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\r\n}\r\n\r\n.section-title {\r\n  font-size: 1.125rem;\r\n  font-weight: 600;\r\n  color: #1a202c;\r\n  margin: 0 0 1rem 0;\r\n  padding-bottom: 0.75rem;\r\n  border-bottom: 2px solid var(--primary-light);\r\n}\r\n\r\n/* 商品信息 */\r\n.product-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 1.5rem;\r\n}\r\n\r\n.product-images {\r\n  display: flex;\r\n  gap: 1rem;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.product-image {\r\n  width: 120px;\r\n  height: 120px;\r\n  object-fit: cover;\r\n  border-radius: 8px;\r\n  cursor: pointer;\r\n  transition: transform 0.2s;\r\n  border: 1px solid var(--gray-200);\r\n}\r\n\r\n.product-image:hover {\r\n  transform: scale(1.05);\r\n}\r\n\r\n.product-details {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 1rem;\r\n}\r\n\r\n.product-title {\r\n  font-size: 1.25rem;\r\n  font-weight: 600;\r\n  color: #1a202c;\r\n  margin: 0;\r\n}\r\n\r\n.product-spec {\r\n  font-size: 0.875rem;\r\n  color: var(--gray-500);\r\n}\r\n\r\n.product-price-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.75rem;\r\n  padding: 1rem;\r\n  background: var(--gray-100);\r\n  border-radius: 8px;\r\n}\r\n\r\n.price-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.price-label {\r\n  font-size: 0.875rem;\r\n  color: var(--gray-600);\r\n}\r\n\r\n.price-value {\r\n  font-size: 0.875rem;\r\n  color: #1a202c;\r\n  font-weight: 500;\r\n}\r\n\r\n.price-row.total {\r\n  padding-top: 0.75rem;\r\n  border-top: 2px solid rgba(107, 70, 193, 0.2);\r\n  margin-top: 0.25rem;\r\n}\r\n\r\n.price-row.total .price-label {\r\n  font-size: 1rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.total-price {\r\n  font-size: 1.5rem;\r\n  font-weight: 700;\r\n  color: var(--primary);\r\n}\r\n\r\n/* 收货信息 */\r\n.delivery-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 1rem;\r\n}\r\n\r\n.info-row {\r\n  display: flex;\r\n  align-items: flex-start;\r\n  gap: 1rem;\r\n}\r\n\r\n.info-label {\r\n  font-size: 0.875rem;\r\n  color: var(--gray-600);\r\n  min-width: 80px;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.info-value {\r\n  font-size: 0.875rem;\r\n  color: #1a202c;\r\n  flex: 1;\r\n}\r\n\r\n/* 订单备注 */\r\n.remark-text {\r\n  font-size: 0.875rem;\r\n  color: #1a202c;\r\n  line-height: 1.6;\r\n  margin: 0;\r\n  padding: 1rem;\r\n  background: var(--gray-100);\r\n  border-radius: 8px;\r\n}\r\n\r\n/* 操作按钮 */\r\n.action-section {\r\n  display: flex;\r\n  gap: 1rem;\r\n  flex-wrap: wrap;\r\n  padding: 1.5rem;\r\n  background: var(--white);\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 8px rgba(107, 70, 193, 0.08);\r\n}\r\n\r\n.btn-action {\r\n  flex: 1;\r\n  min-width: 120px;\r\n  padding: 0.875rem 1.5rem;\r\n  border: none;\r\n  border-radius: 8px;\r\n  font-size: 0.875rem;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.btn-action.btn-primary {\r\n  background: var(--primary);\r\n  color: var(--white);\r\n}\r\n\r\n.btn-action.btn-primary:hover {\r\n  background: var(--primary-dark);\r\n}\r\n\r\n.btn-action.btn-secondary {\r\n  background: var(--white);\r\n  color: var(--primary);\r\n  border: 1px solid var(--primary);\r\n}\r\n\r\n.btn-action.btn-secondary:hover {\r\n  background: var(--primary-light);\r\n  color: var(--white);\r\n}\r\n\r\n.btn-action.btn-cancel {\r\n  background: var(--white);\r\n  color: var(--error);\r\n  border: 1px solid var(--error);\r\n}\r\n\r\n.btn-action.btn-cancel:hover {\r\n  background: var(--error);\r\n  color: var(--white);\r\n}\r\n\r\n.btn-action.btn-default {\r\n  background: var(--gray-200);\r\n  color: var(--gray-600);\r\n}\r\n\r\n.btn-action.btn-default:hover {\r\n  background: var(--gray-300);\r\n}\r\n\r\n/* 图片预览模态框 */\r\n.image-modal {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.9);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 2000;\r\n  padding: 2rem;\r\n}\r\n\r\n.preview-image {\r\n  max-width: 90%;\r\n  max-height: 90%;\r\n  object-fit: contain;\r\n  border-radius: 8px;\r\n}\r\n\r\n.close-preview {\r\n  position: absolute;\r\n  top: 2rem;\r\n  right: 2rem;\r\n  width: 40px;\r\n  height: 40px;\r\n  border: none;\r\n  background: rgba(255, 255, 255, 0.2);\r\n  color: var(--white);\r\n  border-radius: 50%;\r\n  font-size: 1.5rem;\r\n  cursor: pointer;\r\n  transition: background 0.2s;\r\n}\r\n\r\n.close-preview:hover {\r\n  background: rgba(255, 255, 255, 0.3);\r\n}\r\n\r\n/* 退款对话框 */\r\n.dialog-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 2000;\r\n  padding: 1rem;\r\n}\r\n\r\n.dialog-content {\r\n  background: var(--white);\r\n  border-radius: 12px;\r\n  padding: 2rem;\r\n  width: 100%;\r\n  max-width: 500px;\r\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.dialog-title {\r\n  font-size: 1.25rem;\r\n  font-weight: 600;\r\n  color: #1a202c;\r\n  margin: 0 0 1.5rem 0;\r\n}\r\n\r\n.dialog-body {\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.form-group {\r\n  margin-bottom: 1rem;\r\n}\r\n\r\n.form-label {\r\n  display: block;\r\n  margin-bottom: 0.5rem;\r\n  font-size: 0.875rem;\r\n  font-weight: 500;\r\n  color: #1a202c;\r\n}\r\n\r\n.required {\r\n  color: var(--error);\r\n}\r\n\r\n.form-input,\r\n.form-textarea {\r\n  width: 100%;\r\n  padding: 0.75rem;\r\n  border: 1px solid var(--gray-300);\r\n  border-radius: 8px;\r\n  font-size: 0.875rem;\r\n  font-family: inherit;\r\n  transition: border-color 0.2s;\r\n}\r\n\r\n.form-input:focus,\r\n.form-textarea:focus {\r\n  outline: none;\r\n  border-color: var(--primary);\r\n}\r\n\r\n.form-textarea {\r\n  resize: vertical;\r\n  min-height: 100px;\r\n}\r\n\r\n.dialog-footer {\r\n  display: flex;\r\n  gap: 1rem;\r\n  justify-content: flex-end;\r\n}\r\n\r\n.btn-dialog {\r\n  padding: 0.75rem 1.5rem;\r\n  border: none;\r\n  border-radius: 8px;\r\n  font-size: 0.875rem;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.btn-dialog.btn-cancel {\r\n  background: var(--gray-200);\r\n  color: var(--gray-600);\r\n}\r\n\r\n.btn-dialog.btn-cancel:hover {\r\n  background: var(--gray-300);\r\n}\r\n\r\n.btn-dialog.btn-confirm {\r\n  background: var(--primary);\r\n  color: var(--white);\r\n}\r\n\r\n.btn-dialog.btn-confirm:hover {\r\n  background: var(--primary-dark);\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 768px) {\r\n  .header {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .main-content {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .status-card,\r\n  .section-card {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .product-images {\r\n    justify-content: center;\r\n  }\r\n\r\n  .product-image {\r\n    width: 100px;\r\n    height: 100px;\r\n  }\r\n\r\n  .action-section {\r\n    flex-direction: column;\r\n  }\r\n\r\n  .btn-action {\r\n    width: 100%;\r\n  }\r\n\r\n  .dialog-content {\r\n    padding: 1.5rem;\r\n  }\r\n\r\n  .dialog-footer {\r\n    flex-direction: column;\r\n  }\r\n\r\n  .btn-dialog {\r\n    width: 100%;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}